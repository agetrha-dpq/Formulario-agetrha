<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Gestão de Membros AGETRHA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #1a4e8e;
            --secondary: #2a6cba;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px 0;
            transition: all 0.3s;
            box-shadow: 3px 0 10px rgba(0,0,0,0.1);
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            text-align: center;
            border-radius: 0;
            margin: 0;
            padding: 15px;
        }
        
        .sidebar-header img {
            width: 120px;
            margin-bottom: 10px;
        }
        
        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }
        
        .sidebar-menu li {
            padding: 0;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(255,255,255,0.1);
            color: white;
            border-left: 3px solid white;
        }
        
        .sidebar-menu i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Top Bar */
        .top-bar {
            background: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .logo-texto {
            display: flex;
            align-items: center;
            color: var(--primary);
            font-weight: 600;
            font-size: 18px;
        }
        
        .logo-texto img {
            height: 40px;
            margin-right: 10px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
        }
        
        /* Content Area */
        .content {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }
        
        .page-title {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .page-title h1 {
            color: var(--primary);
            font-size: 24px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: var(--dark);
        }
        
        .btn-warning:hover {
            background-color: #e0a800;
            color: var(--dark);
        }
        
        .btn i {
            margin-right: 5px;
        }
        
        /* Cards */
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-left: 4px solid var(--primary);
        }
        
        .card h3 {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 10px;
        }
        
        .card .value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .card .trend {
            font-size: 12px;
            margin-top: 5px;
            display: flex;
            align-items: center;
        }
        
        .trend.up {
            color: var(--success);
        }
        
        .trend.down {
            color: var(--danger);
        }
        
        /* Charts */
        .charts {
            display: grid;
            grid-template-columns: 610px 310px;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: start;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            position: relative;
            height: 395px;
        }
        
        .chart-container.evolucao-mensal {
            width: 610px;
        }
        
        .chart-container.distribuicao-categoria {
            width: 310px;
        }
        
        .chart-title {
            font-size: 16px;
            margin-bottom: 15px;
            color: var(--primary);
            font-weight: 600;
        }
        
        /* Tables */
        .table-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        th {
            background-color: var(--light);
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 1px solid #dee2e6;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
        }
        
        tr:hover {
            background-color: rgba(0,0,0,0.02);
        }
        
        .status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status.regular {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }
        
        .status.suspenso {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger);
        }
        
        .status.pendente {
            background-color: rgba(255, 193, 7, 0.1);
            color: #b58900;
        }
        
        .status.divida {
            background-color: #dc3545;
            color: white;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        
        .action-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            min-width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .action-btn.view {
            background-color: rgba(26, 78, 142, 0.1);
            color: var(--primary);
        }
        
        .action-btn.edit {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }
        
        .action-btn.delete {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger);
        }
        
        /* Forms */
        .form-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 15px;
        }
        
        .form-control:read-only {
            background-color: #f8f9fa;
            color: #6c757d;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        /* Filters */
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-group label {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--gray);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: 600;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Payment Status */
        .payment-status {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .payment-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            transition: all 0.3s;
        }
        
        .payment-btn.paid {
            background-color: var(--success);
            color: white;
        }
        
        .payment-btn.overdue {
            background-color: var(--danger);
            color: white;
        }
        
        /* ===== ESTILOS DO ORGANOGRAMA ===== */
        .organograma-container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            position: relative;
            overflow-x: auto;
        }
        
        .organograma {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 1200px;
        }
        
        /* Linhas do organograma */
        .org-level {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-bottom: 40px;
            position: relative;
        }
        
        /* Cartões de cargo */
        .org-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
            text-align: center;
            width: 200px;
            margin: 0 15px;
            position: relative;
            transition: all 0.3s;
            z-index: 2;
        }
        
        .org-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        
        .org-card.vaga {
            background-color: #f8f9fa;
            border: 1px dashed var(--gray);
        }
        
        .photo-placeholder {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            border: 3px solid var(--primary);
            color: #000;
            font-size: 24px;
            font-weight: bold;
        }
        
        .org-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 10px;
            border: 3px solid var(--primary);
        }
        
        .org-photo.placeholder {
            background-color: #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-size: 24px;
            font-weight: bold;
        }
        
        .org-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 5px;
            color: var(--dark);
        }
        
        .org-position {
            font-size: 12px;
            color: var(--primary);
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .org-member-id {
            font-size: 11px;
            color: var(--gray);
        }
        
        .org-vaga {
            font-size: 12px;
            color: var(--gray);
            font-style: italic;
            margin-top: 10px;
        }
        
        .org-actions {
            margin-top: 10px;
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        
        .org-action-btn {
            padding: 5px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .org-action-btn.edit {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }
        
        .org-action-btn.delete {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger);
        }
        
        /* Títulos das seções */
        .org-section-title {
            text-align: center;
            margin: 30px 0 20px;
            color: var(--primary);
            font-weight: 600;
            font-size: 18px;
            position: relative;
            padding-bottom: 10px;
        }
        
        .org-section-title:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: var(--primary);
        }
        
        /* Estrutura Hierárquica Vertical */
        .org-departamento {
            margin-bottom: 60px;
            position: relative;
        }
        
        .org-hierarchy {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        
        .org-hierarchy-level {
            display: flex;
            justify-content: center;
            position: relative;
            margin-bottom: 20px;
            width: 100%;
        }
        
        .org-hierarchy-level:not(:last-child)::after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 20px;
            background-color: var(--primary);
        }
        
        .org-hierarchy-level.multiple::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 2px;
            background-color: var(--primary);
        }
        
        .org-hierarchy-level.multiple .org-card {
            position: relative;
        }
        
        .org-hierarchy-level.multiple .org-card:not(:first-child)::before {
            content: '';
            position: absolute;
            top: -25px;
            left: -50%;
            width: 100%;
            height: 2px;
            background-color: var(--primary);
        }
        
        .photo-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin: 10px auto;
            border: 3px solid var(--primary);
            display: block;
        }
        
        .photo-preview.placeholder {
            background-color: #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-size: 40px;
            font-weight: bold;
        }
        
        /* Botão para expandir/recolher departamentos */
        .toggle-departments {
            text-align: center;
            margin: 20px 0;
        }
        
        /* Estilos para a seção de chefes */
        .chefes-container {
            display: none;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .chefes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .chefe-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
            text-align: center;
            transition: all 0.3s;
        }
        
        .chefe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        
        .chefe-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 15px;
            border: 3px solid var(--primary);
        }
        
        .chefe-photo.placeholder {
            background-color: #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-size: 30px;
            font-weight: bold;
        }
        
        .chefe-nome {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
            color: var(--dark);
        }
        
        .chefe-cargo {
            font-size: 14px;
            color: var(--primary);
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .chefe-departamento {
            font-size: 12px;
            color: var(--gray);
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .chefe-id {
            font-size: 11px;
            color: var(--gray);
        }
        
        /* ===== ESTILOS DOS RELATÓRIOS ===== */
        .relatorios-container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .relatorios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .relatorio-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .relatorio-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .relatorio-capa {
            width: 120px;
            height: 160px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            margin: 0 auto 15px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .relatorio-capa::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(0,0,0,0.1) 100%);
            border-radius: 8px;
        }
        
        .relatorio-icon {
            font-size: 40px;
            margin-bottom: 10px;
            z-index: 1;
        }
        
        .relatorio-titulo-capa {
            font-size: 14px;
            font-weight: 600;
            z-index: 1;
            text-align: center;
            padding: 0 5px;
        }
        
        .relatorio-nome {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
            color: var(--dark);
        }
        
        .relatorio-data {
            font-size: 12px;
            color: var(--gray);
            margin-bottom: 10px;
        }
        
        .relatorio-tipo {
            font-size: 11px;
            color: var(--primary);
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .relatorio-acoes {
            margin-top: 10px;
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        
        .relatorio-acao-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .relatorio-acao-btn.view {
            background-color: rgba(26, 78, 142, 0.1);
            color: var(--primary);
        }
        
        .relatorio-acao-btn.delete {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger);
        }
        
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s;
            background-color: #f8f9fa;
        }
        
        .upload-area:hover {
            border-color: var(--primary);
            background-color: #f0f7ff;
        }
        
        .upload-area i {
            font-size: 50px;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .upload-area p {
            color: var(--gray);
            margin-bottom: 15px;
        }
        
        .file-input {
            display: none;
        }
        
        .file-info {
            margin-top: 15px;
            padding: 10px;
            background-color: #e9f7ef;
            border-radius: 5px;
            border-left: 4px solid var(--success);
        }
        
        .file-info.error {
            background-color: #fde8e8;
            border-left-color: var(--danger);
        }
        
        /* Estilos dos Projectos */
        .btn-info-light {
            background-color: #ffeaa7;
            color: #343a40;
        }
        
        .btn-info-light:hover {
            background-color: #fdcb6e;
            color: #343a40;
        }
        
        .status-planeamento {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background-color: rgba(255, 165, 0, 0.1);
            color: #b58900;
        }
        
        .status-execucao {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background-color: rgba(135, 206, 235, 0.1);
            color: #1a4e8e;
        }
        
        .status-concluido {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background-color: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }
        
        .status-suspenso {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background-color: rgba(139, 0, 0, 0.1);
            color: #8B0000;
        }
        
        /* Estilos para PDFs */
        .pdfs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .pdf-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            text-align: center;
            transition: all 0.3s;
        }
        
        .pdf-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        
        .pdf-icon {
            font-size: 40px;
            color: #dc3545;
            margin-bottom: 15px;
        }
        
        .pdf-name {
            font-weight: 600;
            margin-bottom: 10px;
            color: #343a40;
        }
        
        .pdf-date {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 15px;
        }
        
        .pdf-actions {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        
        .btn-small {
            padding: 6px 10px;
            font-size: 12px;
        }
        
        /* Detalhes do projeto */
        .project-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .detail-group {
            margin-bottom: 15px;
        }
        
        .detail-label {
            font-weight: 600;
            color: #343a40;
            margin-bottom: 5px;
            display: block;
        }
        
        .detail-value {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        
        .detail-description {
            grid-column: 1 / -1;
        }
        
        .detail-description .detail-value {
            min-height: 120px;
        }
        
        /* Link modal */
        .link-modal {
            text-align: center;
            padding: 20px;
        }
        
        .link-modal h3 {
            color: #1a4e8e;
            margin-bottom: 15px;
        }
        
        .link-modal .pdf-link {
            display: inline-block;
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 10px 0;
            word-break: break-all;
            border: 1px solid #ddd;
        }

/* ===== ESTILOS DAS CONFIGURAÇÕES ===== */
.color-option {
    text-align: center;
    cursor: pointer;
    padding: 10px;
    border-radius: 8px;
    transition: all 0.3s;
    border: 2px solid transparent;
}

.color-option:hover {
    background-color: rgba(0,0,0,0.05);
}

.color-option.active {
    border-color: var(--primary);
    background-color: rgba(26, 78, 142, 0.1);
}

.color-preview {
    width: 60px;
    height: 40px;
    border-radius: 6px;
    margin: 0 auto 8px;
    border: 2px solid #fff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.btn-outline {
    background: transparent;
    border: 2px solid var(--primary);
    color: var(--primary);
}

.btn-outline.active {
    background: var(--primary);
    color: white;
}

.language-btn.active {
    background: var(--primary);
    color: white;
}

/* Temas de Cores */
[data-theme="green"] {
    --primary: #2e7d32;
    --secondary: #4caf50;
}

[data-theme="purple"] {
    --primary: #6a1b9a;
    --secondary: #9c27b0;
}

[data-theme="orange"] {
    --primary: #e65100;
    --secondary: #ff9800;
}

[data-theme="red"] {
    --primary: #c62828;
    --secondary: #f44336;
}

[data-theme="dark"] {
    --primary: #263238;
    --secondary: #455a64;
    --light: #37474f;
    --dark: #eceff1;
}

/* ===== MELHORIAS NO MODO ESCURO - CORRIGIDO ===== */
body.dark-mode {
    background-color: #121212;
    /* Não force cor globalmente */
}

/* Apenas elementos com fundo escuro terão texto branco */
body.dark-mode .card,
body.dark-mode .chart-container,
body.dark-mode .table-container,
body.dark-mode .form-container,
body.dark-mode .organograma-container,
body.dark-mode .relatorios-container,
body.dark-mode .chefes-container,
body.dark-mode .modal-content,
body.dark-mode .top-bar,
body.dark-mode .sidebar,
body.dark-mode .sidebar-menu a {
    color: #e0e0e0 !important;
}

/* Títulos e textos importantes em branco para contraste */
body.dark-mode .card h3,
body.dark-mode .chart-title,
body.dark-mode .page-title h1,
body.dark-mode .org-section-title,
body.dark-mode .org-name,
body.dark-mode .org-position,
body.dark-mode .chefe-nome,
body.dark-mode .chefe-cargo,
body.dark-mode .relatorio-nome,
body.dark-mode .detail-label,
body.dark-mode .filter-group label,
body.dark-mode .form-group label,
body.dark-mode .modal-header h2 {
    color: #ffffff !important;
}

/* Valores nos cards em branco */
body.dark-mode .card .value {
    color: #ffffff !important;
}

/* Status - manter cores originais mas ajustar contraste */
body.dark-mode .status.regular {
    background-color: rgba(40, 167, 69, 0.3);
    color: #90ee90 !important;
}

body.dark-mode .status.suspenso {
    background-color: rgba(220, 53, 69, 0.3);
    color: #ff7f7f !important;
}

body.dark-mode .status.pendente {
    background-color: rgba(255, 193, 7, 0.3);
    color: #ffec8b !important;
}

body.dark-mode .status.divida {
    background-color: rgba(220, 53, 69, 0.6);
    color: #ffffff !important;
}

/* Botões - texto branco apenas em botões escuros */
body.dark-mode .btn-primary,
body.dark-mode .btn-success,
body.dark-mode .btn-danger {
    color: #ffffff !important;
}

/* Botão warning mantém texto escuro */
body.dark-mode .btn-warning {
    color: #000000 !important;
}

/* Botões de ação nas tabelas */
body.dark-mode .action-btn.view,
body.dark-mode .action-btn.edit,
body.dark-mode .action-btn.delete {
    color: inherit !important; /* Manter cores originais */
}

/* Tabelas */
body.dark-mode th {
    background-color: #2d2d2d;
    color: #ffffff !important;
    border-bottom: 1px solid #444;
}

body.dark-mode td {
    border-bottom: 1px solid #444;
    color: #e0e0e0 !important;
}

/* Formulários - texto branco em fundos escuros */
body.dark-mode .form-control {
    background-color: #2d2d2d;
    border: 1px solid #444;
    color: #ffffff !important;
}

body.dark-mode .form-control:read-only {
    background-color: #3d3d3d;
    color: #b0b0b0 !important;
}

/* Tabs */
body.dark-mode .tabs {
    border-bottom: 1px solid #444;
}

body.dark-mode .tab.active {
    border-bottom: 3px solid #ffffff;
    color: #ffffff !important;
}

body.dark-mode .tab {
    color: #b0b0b0 !important;
}

/* Filtros */
body.dark-mode .filter-group label {
    color: #b0b0b0 !important;
}

/* Modal */
body.dark-mode .modal-content {
    background: #1e1e1e;
    color: #e0e0e0 !important;
}

body.dark-mode .modal-header {
    border-bottom: 1px solid #444;
}

body.dark-mode .modal-footer {
    border-top: 1px solid #444;
}

/* Gráficos containers */
body.dark-mode .chart-container {
    background: #1e1e1e;
    color: #ffffff !important;
}

/* Textos secundários em cinza */
body.dark-mode .trend,
body.dark-mode .org-member-id,
body.dark-mode .chefe-id,
body.dark-mode .relatorio-data,
body.dark-mode .relatorio-tipo,
body.dark-mode .pdf-date,
body.dark-mode small,
body.dark-mode .text-muted {
    color: #b0b0b0 !important;
}

/* Placeholders */
body.dark-mode .org-photo.placeholder,
body.dark-mode .chefe-photo.placeholder {
    background-color: #555;
    color: #ccc !important;
}

/* Upload area */
body.dark-mode .upload-area {
    border: 2px dashed #666;
    background-color: #2d2d2d;
    color: #e0e0e0 !important;
}

body.dark-mode .upload-area:hover {
    border-color: var(--primary);
    background-color: #363636;
}

/* Sidebar - já está com fundo escuro, então texto claro */
body.dark-mode .sidebar {
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    color: #e0e0e0 !important;
}

body.dark-mode .sidebar-menu a {
    color: rgba(255,255,255,0.8) !important;
}

body.dark-mode .sidebar-menu a:hover, 
body.dark-mode .sidebar-menu a.active {
    background-color: rgba(255,255,255,0.1);
    color: white !important;
}

/* Top bar */
body.dark-mode .top-bar {
    background: #1e1e1e;
    border-bottom: 1px solid #333;
    color: #e0e0e0 !important;
}

/* Logotipo e texto no topo - manter visível */
body.dark-mode .logo-texto {
    color: #ffffff !important;
}

/* User info */
body.dark-mode .user-info div {
    color: #e0e0e0 !important;
}

body.dark-mode .user-info div:last-child {
    color: #b0b0b0 !important;
}

/* ===== ELEMENTOS QUE DEVEM MANTER TEXTO ESCURO ===== */

/* Botões com fundo claro mantêm texto escuro */
body.dark-mode .btn-warning,
body.dark-mode .btn-info-light {
    color: #000000 !important;
}

/* Status badges com fundo claro mantêm texto escuro */
body.dark-mode .status-planeamento,
body.dark-mode .status-execucao,
body.dark-mode .status-concluido,
body.dark-mode .status-suspenso {
    color: #000000 !important;
}

/* Elementos de ação que têm fundo colorido claro */
body.dark-mode .action-btn.view,
body.dark-mode .action-btn.edit,
body.dark-mode .action-btn.delete,
body.dark-mode .org-action-btn.edit,
body.dark-mode .org-action-btn.delete,
body.dark-mode .relatorio-acao-btn.view,
body.dark-mode .relatorio-acao-btn.delete {
    color: inherit !important; /* Manter cores originais dos ícones */
}

/* Payment buttons */
body.dark-mode .payment-btn.paid,
body.dark-mode .payment-btn.overdue {
    color: #ffffff !important; /* Estes têm fundo colorido, texto branco */
}

function aplicarConfiguracoes() {
    const temaSelecionado = document.querySelector('.color-option.active')?.dataset.theme || 'default';
    const idiomaSelecionado = document.querySelector('.language-btn.active')?.dataset.lang || 'pt';
    const darkMode = document.getElementById('toggle-dark-mode').checked;
    const sidebarCompacta = document.getElementById('toggle-sidebar-compact').checked;

    // Aplicar tema
    document.documentElement.setAttribute('data-theme', temaSelecionado);
    
    // Aplicar modo escuro
    if (darkMode) {
        document.body.classList.add('dark-mode');
    } else {
        document.body.classList.remove('dark-mode');
    }
    
    // Aplicar sidebar compacta
    if (sidebarCompacta) {
        document.querySelector('.sidebar').classList.add('compact');
    } else {
        document.querySelector('.sidebar').classList.remove('compact');
    }
    
    // Aplicar idioma
    aplicarIdioma(idiomaSelecionado);

    // Salvar configurações
    salvarConfiguracoes({
        tema: temaSelecionado,
        idioma: idiomaSelecionado,
        darkMode: darkMode,
        sidebarCompacta: sidebarCompacta
    });

    alert('Configurações aplicadas com sucesso!');
    fecharModalConfiguracoes();
}

/* ===== CORREÇÕES ESPECÍFICAS PARA FONTES NO MODO ESCURO ===== */

/* Elementos que devem manter texto escuro em fundos claros */
body.dark-mode .btn-warning,
body.dark-mode .btn-info-light,
body.dark-mode .status-planeamento,
body.dark-mode .status-execucao,
body.dark-mode .status-concluido,
body.dark-mode .status-suspenso,
body.dark-mode .action-btn.view,
body.dark-mode .action-btn.edit,
body.dark-mode .action-btn.delete,
body.dark-mode .org-action-btn.edit,
body.dark-mode .org-action-btn.delete,
body.dark-mode .relatorio-acao-btn.view,
body.dark-mode .relatorio-acao-btn.delete,
body.dark-mode .payment-btn.paid,
body.dark-mode .payment-btn.overdue {
    color: #000000 !important;
}

/* Garantir que botões com fundos coloridos tenham texto escuro */
body.dark-mode .btn-warning {
    background-color: var(--warning) !important;
    color: #000000 !important;
}

body.dark-mode .btn-info-light {
    background-color: #ffeaa7 !important;
    color: #000000 !important;
}

/* Status com fundos coloridos - texto escuro */
body.dark-mode .status-planeamento {
    background-color: rgba(255, 165, 0, 0.3) !important;
    color: #000000 !important;
}

body.dark-mode .status-execucao {
    background-color: rgba(135, 206, 235, 0.3) !important;
    color: #000000 !important;
}

body.dark-mode .status-concluido {
    background-color: rgba(40, 167, 69, 0.3) !important;
    color: #000000 !important;
}

body.dark-mode .status-suspenso {
    background-color: rgba(139, 0, 0, 0.3) !important;
    color: #000000 !important;
}

/* Botões de ação nas tabelas */
body.dark-mode .action-btn.view {
    background-color: rgba(26, 78, 142, 0.2) !important;
    color: #1a4e8e !important;
}

body.dark-mode .action-btn.edit {
    background-color: rgba(40, 167, 69, 0.2) !important;
    color: #28a745 !important;
}

body.dark-mode .action-btn.delete {
    background-color: rgba(220, 53, 69, 0.2) !important;
    color: #dc3545 !important;
}

/* Botões do organograma */
body.dark-mode .org-action-btn.edit {
    background-color: rgba(40, 167, 69, 0.2) !important;
    color: #28a745 !important;
}

body.dark-mode .org-action-btn.delete {
    background-color: rgba(220, 53, 69, 0.2) !important;
    color: #dc3545 !important;
}

/* Botões de relatórios */
body.dark-mode .relatorio-acao-btn.view {
    background-color: rgba(26, 78, 142, 0.2) !important;
    color: #1a4e8e !important;
}

body.dark-mode .relatorio-acao-btn.delete {
    background-color: rgba(220, 53, 69, 0.2) !important;
    color: #dc3545 !important;
}

/* Payment buttons */
body.dark-mode .payment-btn.paid {
    background-color: var(--success) !important;
    color: #ffffff !important;
}

body.dark-mode .payment-btn.overdue {
    background-color: var(--danger) !important;
    color: #ffffff !important;
}

/* Garantir que elementos com fundo branco no modo claro tenham fundo escuro no modo escuro */
body.dark-mode .card,
body.dark-mode .chart-container,
body.dark-mode .table-container,
body.dark-mode .form-container,
body.dark-mode .organograma-container,
body.dark-mode .relatorios-container,
body.dark-mode .chefes-container,
body.dark-mode .modal-content {
    background: #1e1e1e !important;
}

/* Ajustar bordas para melhor contraste */
body.dark-mode .card,
body.dark-mode .chart-container,
body.dark-mode .table-container,
body.dark-mode .form-container,
body.dark-mode .organograma-container,
body.dark-mode .relatorios-container,
body.dark-mode .chefes-container {
    border: 1px solid #333 !important;
}

/* Ajustar cores dos botões principais para melhor contraste */
body.dark-mode .btn-primary {
    background-color: var(--primary) !important;
    border-color: var(--primary) !important;
    color: #ffffff !important;
}

body.dark-mode .btn-success {
    background-color: var(--success) !important;
    border-color: var(--success) !important;
    color: #ffffff !important;
}

body.dark-mode .btn-danger {
    background-color: var(--danger) !important;
    border-color: var(--danger) !important;
    color: #ffffff !important;
}


/* ===== ESTILOS DO MODAL DE BOAS-VINDAS ===== */
#main-application {
    display: none;
}

#modal-welcome {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.7);
    z-index: 100000;
    justify-content: center;
    align-items: center;
}

#modal-welcome .modal-content {
    background: white;
    border-radius: 15px;
    padding: 40px 30px;
    text-align: center;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    animation: welcomeFadeIn 0.5s ease-out;
}

@keyframes welcomeFadeIn {
    from { opacity: 0; transform: scale(0.8); }
    to { opacity: 1; transform: scale(1); }
}

.welcome-icon {
    font-size: 60px;
    color: var(--primary);
    margin-bottom: 20px;
}

.welcome-title {
    color: var(--primary);
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 15px;
}

.welcome-message {
    color: var(--dark);
    font-size: 16px;
    line-height: 1.5;
    margin-bottom: 25px;
}

/* Responsive */
@media (max-width: 1200px) {
        
        /* Responsive */
        @media (max-width: 1200px) {
            .charts {
                grid-template-columns: 1fr;
                justify-content: center;
            }
            
            .chart-container.evolucao-mensal,
            .chart-container.distribuicao-categoria {
                width: 100%;
                max-width: 610px;
            }
        }
        
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar-header h2, .sidebar-menu span {
                display: none;
            }
            
            .sidebar-menu a {
                justify-content: center;
                padding: 15px;
            }
            
            .sidebar-menu i {
                margin-right: 0;
                font-size: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .cards {
                grid-template-columns: 1fr 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 350px;
            }
            
            .page-title {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .page-title h1 {
                font-size: 20px;
            }
            
            .btn {
                padding: 8px 16px;
                font-size: 14px;
            }
            
            .content {
                padding: 15px;
            }
            
            .organograma-container {
                padding: 15px;
            }
            
            .org-card {
                width: 160px;
                margin: 0 10px;
            }
            
            .chefes-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .relatorios-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .relatorio-capa {
                width: 100px;
                height: 140px;
            }
        }
        
        @media (max-width: 576px) {
            .cards {
                grid-template-columns: 1fr;
            }
            
            .top-bar {
                flex-direction: column;
                align-items: flex-start;
                padding: 15px;
            }
            
            .logo-texto {
                margin-bottom: 15px;
            }
            
            .chart-container {
                height: 300px;
                padding: 15px;
            }
            
            .content {
                padding: 15px;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 5px;
            }
            
            .action-btn {
                padding: 10px;
                font-size: 12px;
                min-width: 35px;
                min-height: 35px;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .filter-group {
                width: 100%;
            }
            
            .table-container {
                padding: 10px;
            }
            
            th, td {
                padding: 8px 10px;
                font-size: 14px;
            }
            
            table {
                min-width: 700px;
            }
            
            td:last-child {
                position: sticky;
                right: 0;
                background: white;
                box-shadow: -2px 0 5px rgba(0,0,0,0.1);
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .chefes-grid {
                grid-template-columns: 1fr;
            }
            
            .relatorios-grid {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
                gap: 15px;
            }
            
            .relatorio-card {
                padding: 15px;
            }
            
            .relatorio-capa {
                width: 90px;
                height: 120px;
            }
            
            .relatorio-icon {
                font-size: 30px;
            }
            
            .relatorio-titulo-capa {
                font-size: 12px;
            }
        }
        
        @media (max-width: 400px) {
            .action-buttons {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .action-btn {
                min-width: 32px;
                min-height: 32px;
                padding: 6px 8px;
            }
            
            .action-btn i {
                margin: 0;
            }
            
            .action-btn span {
                display: none;
            }
            
            .relatorios-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

/* ===== ESTILOS DO MODAL DE LOGIN ===== */
#modal-login {
    background-color: rgba(0, 0, 0, 0.95) !important;
    backdrop-filter: blur(10px);
    z-index: 99999 !important;
}

#modal-login .modal-content {
    background: white;
    border-radius: 15px;
    padding: 0;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    border: none;
    position: relative;
    z-index: 100000;
}

/* Garantir que nada fique atrás do login */
body:has(#modal-login[style*="display: flex"]) {
    background: #1a4e8e !important;
}

body:has(#modal-login[style*="display: flex"]) > *:not(#modal-login):not(#modal-welcome) {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
}
    

/* ESTILO DE EMERGÊNCIA - GARANTIR QUE NADA VAZE */
body.login-active {
    background: #1a4e8e !important;
    overflow: hidden !important;
}

body.login-active > *:not(#modal-login):not(#modal-welcome) {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
}

#modal-login {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    background: rgba(0,0,0,0.95) !important;
    z-index: 99999 !important;
}

</style>
</head>
<body>
   
 <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <!-- Logotipo AGETRHA -->
        </div>
        <ul class="sidebar-menu">
    <li><a href="#" class="active" data-page="resumo"><i class="fas fa-home"></i> <span data-i18n="resumo">Resumo</span></a></li>
    <li><a href="#" data-page="gestao-membros"><i class="fas fa-users"></i> <span data-i18n="gestao-membros">Gestão de Membros</span></a></li>
    <li><a href="#" data-page="organograma"><i class="fas fa-sitemap"></i> <span data-i18n="organograma">Organograma</span></a></li>
    <li><a href="https://agetrha-dpq.github.io/Formulario-agetrha/Dashboard_gestao_Candidaturas" target="_blank"><i class="fas fa-user-plus"></i> <span data-i18n="candidaturas">Candidaturas</span></a></li>
    <li><a href="#" data-page="projectos"><i class="fas fa-project-diagram"></i> <span data-i18n="projectos">Projectos</span></a></li>
    <li><a href="#" data-page="relatorios"><i class="fas fa-chart-bar"></i> <span data-i18n="relatorios">Relatórios</span></a></li>
    <li><a href="#" data-page="configuracoes"><i class="fas fa-cogs"></i> <span data-i18n="configuracoes">Configurações</span></a></li>
</ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="logo-texto">
                <img src="https://i.postimg.cc/DyKZTbYq/Logotipo.jpg" alt="AGETRHA Logo">
                <strong data-i18n="dep-pessoal-quadros">DEP. PESSOAL E QUADROS - AGETRHA</strong>
            </div>
            <div class="user-info">
                <img id="presidentPhoto" src="https://drive.google.com/thumbnail?id=1c38dXZUgqkgRKxkvI28phzKtGgaqVCov&sz=w400" alt="Geraldina Francisco">
                <div>
                    <div style="font-weight: 600;">Geraldina Francisco</div>
                    <div style="font-size: 12px; color: var(--gray);" data-i18n="presidente">Presidente</div>
                </div>
            </div>
        </div>


<div id="main-application" style="display: none;">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <!-- Logotipo AGETRHA -->
        </div>
        <ul class="sidebar-menu">
            <!-- ... menu items ... -->
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <!-- ... top bar content ... -->
        </div>

        <!-- Content Area -->
        <div class="content">
            <!-- ... todo o resto do conteúdo ... -->
        </div>
    </div>
</div>


        <!-- Content Area -->
        <div class="content">
            <!-- Resumo Content (inicialmente visível) -->
            <div id="resumo-content" style="display: block;">
                <div class="page-title">
                    <h1><i class="fas fa-home"></i> <span data-i18n="resumo">Resumo</span></h1>
                    <button class="btn btn-primary" onclick="window.open('https://agetrha-dpq.github.io/Formulario-agetrha/', '_blank')"><i class="fas fa-plus"></i> <span data-i18n="novo-membro">Novo Membro</span>
                </div>

                <!-- Cards -->
                <div class="cards">
                    <div class="card">
                        <h3 data-i18n="total-membros">TOTAL DE MEMBROS</h3>
                        <div class="value" id="total-membros">0</div>
                        <div class="trend up" id="trend-total"><i class="fas fa-arrow-up"></i> <span id="percent-total">0%</span> desde o último mês</div>
                    </div>
                    <div class="card">
                        <h3 data-i18n="membros-regulares">MEMBROS REGULARES</h3>
                        <div class="value" id="membros-regulares">0</div>
                        <div class="trend up" id="trend-regulares"><i class="fas fa-arrow-up"></i> <span id="percent-regulares">0%</span> desde o último mês</div>
                    </div>
                    <div class="card">
                        <h3 data-i18n="inadimplentes">INADIMPLENTES</h3>
                        <div class="value" id="membros-inadimplentes">0</div>
                        <div class="trend down" id="trend-inadimplentes"><i class="fas fa-arrow-down"></i> <span id="percent-inadimplentes">0%</span> desde o último mês</div>
                    </div>
                    <div class="card">
                        <h3 data-i18n="total-candidaturas">TOTAL DE CANDIDATURAS</h3>
                        <div class="value" id="total-candidaturas">0</div>
                        <div class="trend up" id="trend-candidaturas"><i class="fas fa-arrow-up"></i> <span id="percent-candidaturas">0%</span> desde o último mês</div>
                    </div>
                </div>

                <!-- Charts - Com dimensões fixas conforme especificado -->
                <div class="charts">
                    <div class="chart-container evolucao-mensal">
                        <div class="chart-title" data-i18n="evolucao-mensal">Evolução Mensal de Novos Membros</div>
                        <canvas id="membersChart"></canvas>
                    </div>
                    <div class="chart-container distribuicao-categoria">
                        <div class="chart-title" data-i18n="distribuicao-categoria">Distribuição de Membros por Categoria</div>
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

                <div class="page-title">
                    <h1><i class="fas fa-users"></i> <span data-i18n="membros-recentes">Membros Recentes</span></h1>
                    <button class="btn btn-primary" id="btn-exportar-resumo" onclick="exportarResumoPDF()"><i class="fas fa-download"></i> <span data-i18n="exportar">Exportar</span>
                </div>

                <div class="table-container">
<table id="tabela-membros-recentes">
    <thead>
        <tr>
            <th data-i18n="nome">Nome</th>
            <th data-i18n="categoria">Categoria</th>
            <th data-i18n="data-admissao">Data Admissão</th>
            <th data-i18n="numero-membro">Número de Membro</th>
            <th data-i18n="status">Status</th>
            <th data-i18n="acoes">Ações</th>
        </tr>
    </thead>
    <tbody id="corpo-tabela-membros-recentes">
        <!-- Os membros recentes serão inseridos aqui via JavaScript -->
    </tbody>
</table>
                </div>
            </div>

            <!-- Gestão de Membros Content -->
            <div id="gestao-membros-content" style="display: none;">
                <div class="page-title">
                    <h1><i class="fas fa-users"></i> <span data-i18n="gestao-membros">Gestão de Membros</span></h1>
                    <button class="btn btn-primary" id="btn-novo-membro"><i class="fas fa-plus"></i> <span data-i18n="novo-membro">Novo Membro</span>
                </div>

                <!-- Filtros -->
<div class="filters">
    <div class="filter-group">
        <label for="filter-categoria" data-i18n="categoria">Categoria</label>
        <select id="filter-categoria" class="form-control">
            <option value="" data-i18n="todas-categorias">Todas as categorias</option>
            <!-- As categorias serão carregadas dinamicamente via JavaScript -->
        </select>
    </div>
    <div class="filter-group">
        <label for="filter-status" data-i18n="status">Status</label>
        <select id="filter-status" class="form-control">
            <option value="" data-i18n="todos-status">Todos os status</option>
            <option value="Regular" data-i18n="regular">Regular</option>
            <option value="Suspenso" data-i18n="suspenso">Suspenso</option>
            <option value="Pendente" data-i18n="pendente">Pendente</option>
            <option value="Dívida" data-i18n="divida">Dívida</option>
        </select>
    </div>
    <div class="filter-group">
        <label for="filter-nome" data-i18n="nome-membro">Nome do Membro</label>
        <input type="text" id="filter-nome" class="form-control" placeholder="Digite o nome..." data-i18n-placeholder="digite-nome">
    </div>
    <div class="filter-group">
        <label>&nbsp;</label>
        <button class="btn btn-primary" id="btn-aplicar-filtros">
            <span data-i18n="aplicar-filtros">Aplicar Filtros</span>
        </button>
    </div>
</div>

                <!-- Tabs -->
                <div class="tabs">
    <div class="tab active" data-tab="todos" data-i18n="todos-membros">Todos os Membros</div>
    <div class="tab" data-tab="regulares" data-i18n="membros-regulares-tab">Membros Regulares</div>
    <div class="tab" data-tab="suspensos" data-i18n="membros-suspensos">Membros Suspensos</div>
    <div class="tab" data-tab="pendentes" data-i18n="membros-pendentes">Membros Pendentes</div>
    <div class="tab" data-tab="divida" data-i18n="membros-divida">Membros em Dívida</div>
</div>

                <!-- Tabela de Membros -->
                <div class="table-container">
                    <table id="tabela-membros">

    <thead>
        <tr>
            <th data-i18n="nome">Nome</th>
            <th data-i18n="categoria">Categoria</th>
            <th data-i18n="data-admissao">Data Admissão</th>
            <th data-i18n="numero-membro">Número de Membro</th>
            <th data-i18n="status">Status</th>
            <th data-i18n="acoes">Ações</th>
        </tr>
    </thead>
    <tbody id="corpo-tabela-membros">
        <!-- Os membros serão inseridos aqui via JavaScript -->
    </tbody>
</table>
</div>
</div>

            <!-- Organograma Content -->
<div id="organograma-content" style="display: none;">
    <div class="page-title">
        <h1><i class="fas fa-sitemap"></i> <span data-i18n="organograma">Organograma</span></h1>
    </div>
    
    <div class="organograma-container">
        <div style="text-align: center; padding: 80px 20px; color: var(--gray);">
            <i class="fas fa-tools" style="font-size: 80px; margin-bottom: 20px; color: var(--warning);"></i>
            <h2 style="color: var(--primary); margin-bottom: 15px;">Página em Desenvolvimento</h2>
            <p style="font-size: 16px; max-width: 500px; margin: 0 auto;">
                O organograma está sendo desenvolvido e estará disponível em breve.<br>
                Aguarde pelas atualizações!
            </p>
        </div>
    </div>
</div>

            <!-- Seção de Chefes -->
<div id="chefes-content" class="chefes-container" style="display: none;">
    <div class="page-title">
        <h1><i class="fas fa-users"></i> Todos os Chefes</h1>
        <button class="btn btn-primary" id="btn-voltar-organograma">
            <i class="fas fa-arrow-left"></i> Voltar ao Organograma
        </button>
    </div>
    
    <div style="text-align: center; padding: 80px 20px; color: var(--gray);">
        <i class="fas fa-tools" style="font-size: 80px; margin-bottom: 20px; color: var(--warning);"></i>
        <h2 style="color: var(--primary); margin-bottom: 15px;">Página em Desenvolvimento</h2>
        <p style="font-size: 16px; max-width: 500px; margin: 0 auto;">
            A lista de chefes está sendo desenvolvida e estará disponível em breve.
        </p>
    </div>
</div>

            <!-- Projectos Content -->
            <div id="projectos-content" style="display: none;">
                <!-- Conteúdo Principal dos Projectos -->
                <div id="projectos-inner-content">
                    <div class="page-title">
                        <h1><i class="fas fa-project-diagram"></i> <span data-i18n="projectos">Projectos</span></h1>
                        <div>
                            <button class="btn btn-primary" id="btn-novo-projecto"><i class="fas fa-plus"></i> Novo Projecto</button>
                            <button class="btn btn-success" id="btn-gerar-relatorio"><i class="fas fa-file-pdf"></i> Gerar Relatório</button>
                            <button class="btn btn-info-light" id="btn-ver-pdfs"><i class="fas fa-folder-open"></i> Ver Projectos PDF</button>
                        </div>
                    </div>

                    <!-- Cards de Estatísticas -->
                    <div class="cards">
                        <div class="card">
                            <h3>TOTAL DE PROJECTOS</h3>
                            <div class="value" id="total-projectos">0</div>
                        </div>
                        <div class="card">
                            <h3>EM EXECUÇÃO</h3>
                            <div class="value" id="projectos-execucao">0</div>
                        </div>
                        <div class="card">
                            <h3>SUSPENSOS</h3>
                            <div class="value" id="projectos-suspensos">0</div>
                        </div>
                        <div class="card">
                            <h3>CONCLUÍDOS</h3>
                            <div class="value" id="projectos-concluidos">0</div>
                        </div>
                        <div class="card">
                            <h3>ORÇAMENTO TOTAL</h3>
                            <div class="value" id="orcamento-total">0 Kz</div>
                        </div>
                    </div>

                    <!-- Gráficos -->
                    <div class="charts">
                        <div class="chart-container">
                            <div class="chart-title">Distribuição por Status</div>
                            <canvas id="statusChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-title">Progresso dos Projectos</div>
                            <canvas id="progressChart"></canvas>
                        </div>
                    </div>

                    <!-- Filtros -->
                    <div class="filters">
                        <div class="filter-group">
                            <label for="filter-projecto-status">Status</label>
                            <select id="filter-projecto-status" class="form-control">
                                <option value="">Todos</option>
                                <option>Planeamento</option>
                                <option>Em Execução</option>
                                <option>Concluído</option>
                                <option>Suspenso</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="filter-projecto-responsavel">Responsável</label>
                            <input type="text" id="filter-projecto-responsavel" class="form-control" placeholder="Nome do responsável">
                        </div>
                        <div class="filter-group">
                            <label>&nbsp;</label>
                            <button id="btn-aplicar-filtros-projectos" class="btn btn-primary">Aplicar Filtros</button>
                        </div>
                    </div>

                    <!-- Tabela de Projectos -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nome do Projecto</th>
                                    <th>Responsável</th>
                                    <th>Data Início</th>
                                    <th>Data Fim</th>
                                    <th>Status</th>
                                    <th>Orçamento</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="corpo-tabela-projectos">
                                <!-- Os projectos serão carregados aqui via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Seção de PDFs (inicialmente oculta) -->
                <div id="pdfs-content" style="display:none">
                    <div class="page-title">
                        <h1><i class="fas fa-folder-open"></i> Projectos em PDF</h1>
                        <div>
                            <button class="btn btn-warning" id="btn-upload-pdf"><i class="fas fa-upload"></i> Upload Projectos</button>
                            <button class="btn btn-primary" id="btn-voltar-projectos"><i class="fas fa-arrow-left"></i> Voltar aos Projectos</button>
                        </div>
                    </div>

                    <div id="pdfs-grid" class="pdfs-grid">
                        <!-- Os PDFs serão carregados aqui via JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Relatórios Content -->
            <div id="relatorios-content" style="display: none;">
    <div class="page-title">
        <h1><i class="fas fa-chart-bar"></i> <span data-i18n="relatorios">Relatórios</span></h1>
        <button class="btn btn-primary" id="btn-upload-relatorio"><i class="fas fa-upload"></i> Upload de Relatório</button>
    </div>

    <div class="relatorios-container">
        <!-- Área de Upload -->
        <div class="upload-area" id="upload-area">
            <i class="fas fa-cloud-upload-alt"></i>
            <h3>Arraste e solte ficheiros PDF aqui</h3>
            <p>ou</p>
            <button class="btn btn-primary" id="btn-selecionar-arquivo">
                <i class="fas fa-folder-open"></i> Selecionar Ficheiro
            </button>
            <input type="file" id="file-input" class="file-input" accept=".pdf">
            <div id="file-info" class="file-info" style="display: none;"></div>
        </div>

        <!-- Grid de Relatórios -->
        <div class="relatorios-grid" id="relatorios-grid">
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--gray);">
                <i class="fas fa-spinner fa-spin" style="font-size: 50px; margin-bottom: 15px;"></i>
                <p>Carregando relatórios...</p>
            </div>
        </div>
    </div>
</div>

    <!-- ========== MODAIS DA PÁGINA DE PROJECTOS ========== -->

    <!-- Modal Projecto -->
    <div id="modal-projecto" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-titulo-projecto">Novo Projecto</h2>
                <button id="btn-fechar-modal-projecto" style="background:none;border:none;font-size:20px;cursor:pointer">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-projecto">
                    <input type="hidden" id="projecto-id">
                    <div class="form-group">
                        <label for="projecto-nome">Nome do Projecto *</label>
                        <input type="text" id="projecto-nome" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="projecto-data-inicio">Data de Início *</label>
                        <input type="date" id="projecto-data-inicio" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="projecto-data-fim">Data de Fim</label>
                        <input type="date" id="projecto-data-fim" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="projecto-responsavel">Responsável *</label>
                        <select id="projecto-responsavel" class="form-control" required>
                            <option value="">Selecione</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="projecto-descricao">Descrição *</label>
                        <textarea id="projecto-descricao" class="form-control" rows="4" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="projecto-status">Status *</label>
                        <select id="projecto-status" class="form-control">
                            <option>Planeamento</option>
                            <option>Em Execução</option>
                            <option>Concluído</option>
                            <option>Suspenso</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="projecto-orcamento">Orçamento (Kz)</label>
                        <input type="number" id="projecto-orcamento" class="form-control" step="0.01" min="0">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" id="btn-cancelar-projecto">Cancelar</button>
                <button class="btn btn-primary" id="btn-salvar-projecto">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Editar Projecto -->
    <div id="modal-editar-projecto" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Projecto</h2>
                <button id="btn-fechar-modal-editar-projecto" style="background:none;border:none;font-size:20px;cursor:pointer">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-editar-projecto">
                    <input type="hidden" id="editar-projecto-id">
                    <div class="form-group">
                        <label for="editar-projecto-status">Status *</label>
                        <select id="editar-projecto-status" class="form-control">
                            <option>Planeamento</option>
                            <option>Em Execução</option>
                            <option>Concluído</option>
                            <option>Suspenso</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editar-projecto-orcamento">Orçamento (Kz)</label>
                        <input type="number" id="editar-projecto-orcamento" class="form-control" step="0.01" min="0">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" id="btn-cancelar-editar-projecto">Cancelar</button>
                <button class="btn btn-primary" id="btn-salvar-editar-projecto">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Upload PDF -->
    <div id="modal-upload-pdf" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Upload de PDF</h2>
                <button id="btn-fechar-modal-upload-pdf" style="background:none;border:none;font-size:20px;cursor:pointer">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-upload-pdf">
                    <div class="form-group">
                        <label for="pdf-nome">Nome do PDF</label>
                        <input type="text" id="pdf-nome" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="pdf-file">Ficheiro PDF</label>
                        <input type="file" id="pdf-file" class="form-control" accept=".pdf" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" id="btn-cancelar-upload-pdf">Cancelar</button>
                <button class="btn btn-primary" id="btn-salvar-pdf">Upload PDF</button>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmação de Upload de PDF -->
    <div id="modal-link-pdf" class="modal">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <div style="padding: 40px 20px;">
                <div style="font-size: 60px; color: #28a745; margin-bottom: 20px;">✔️</div>
                <h3 style="color: #28a745; margin: 0; font-weight: bold;">
                    O seu ficheiro PDF foi guardado com <span style="color: #28a745;">SUCESSO!</span>
                </h3>
            </div>
        </div>
    </div>

    <!-- Modal Ver Projecto -->
    <div id="modal-ver-projecto" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>Detalhes do Projecto</h2>
                <button id="btn-fechar-modal-ver-projecto" style="background:none;border:none;font-size:20px;cursor:pointer">&times;</button>
            </div>
            <div class="modal-body">
                <div class="project-details" id="detalhes-projecto">
                    <!-- Os detalhes serão preenchidos aqui dinamicamente -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="btn-fechar-ver-projecto">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Membro -->
    <div id="modal-membro" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-titulo">Editar Membro</h2>
                <button id="btn-fechar-modal" style="background: none; border: none; font-size: 20px; cursor: pointer;">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-membro">
                    <input type="hidden" id="membro-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nome">Nome</label>
                            <input type="text" id="nome" class="form-control" required readonly>
                        </div>
                        <div class="form-group">
                            <label for="numero-membro">Número de Membro</label>
                            <input type="text" id="numero-membro" class="form-control" readonly>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="categoria">Categoria</label>
                            <input type="text" id="categoria" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label for="telefone">Telefone</label>
                            <input type="text" id="telefone" class="form-control" readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="status">Status</label>
                        <select id="status" class="form-control" required>
                            <option value="">Selecione...</option>
                            <option value="Regular">Regular</option>
                            <option value="Suspenso">Suspenso</option>
                            <option value="Pendente">Pendente</option>
                            <option value="Dívida">Dívida</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Status de Pagamento</label>
                        <div class="payment-status">
                            <button type="button" class="payment-btn overdue" id="btn-em-divida" style="display: none;">
                                <i class="fas fa-exclamation-triangle"></i> Dívida
                            </button>
                            <button type="button" class="payment-btn paid" id="btn-pagou">
                                <i class="fas fa-check"></i> Pagou
                            </button>
                        </div>
                        <div id="info-pagamento" style="margin-top: 10px; font-size: 14px; color: var(--gray);"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" id="btn-cancelar">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btn-salvar-membro">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Visualizar Membro -->
    <div id="modal-ver-membro" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>Detalhes do Membro</h2>
                <button id="btn-fechar-modal-ver" style="background: none; border: none; font-size: 20px; cursor: pointer;">&times;</button>
            </div>
            <div class="modal-body" id="modal-ver-corpo">
                <!-- As informações do membro serão inseridas aqui -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" id="btn-fechar-ver">Fechar</button>
            </div>
        </div>
    </div>

<!-- Modal para Editar Cargo (Organograma) - VERSÃO CORRIGIDA -->
<div id="modal-cargo" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modal-titulo-cargo">Editar Cargo</h2>
            <button id="btn-fechar-modal-cargo" style="background: none; border: none; font-size: 20px; cursor: pointer;">&times;</button>
        </div>
        <div class="modal-body">
            <form id="form-cargo">
                <input type="hidden" id="cargo-id">
                
                <div class="form-group" style="text-align: center;">
                    <div id="photo-preview-container">
                        <img id="photo-preview" src="" class="photo-preview" alt="Pré-visualização da foto" 
                             onerror="this.classList.add('placeholder'); this.innerHTML='?'"
                             onload="this.classList.remove('placeholder')">
                    </div>
                    
                    <!-- APENAS O BOTÃO DE UPLOAD - SEM URL -->
                    <div style="margin: 15px 0;">
                        <label for="foto-upload" style="display: block; margin-bottom: 8px; font-weight: 600;">
                            <i class="fas fa-camera"></i> Upload da Foto
                        </label>
                        <input type="file" id="foto-upload" class="form-control" accept="image/*" style="margin-bottom: 10px;">
                        <button type="button" class="btn btn-primary" id="btn-upload-foto" style="margin-bottom: 15px;">
                            <i class="fas fa-upload"></i> Fazer Upload da Foto
                        </button>
                        <small class="text-muted" style="display: block;">
                            ⚠️ Funcionalidade em desenvolvimento
                        </small>
                    </div>
                    
                    <!-- CAMPO OCULTO PARA ARMAZENAR O ID DA FOTO -->
                    <input type="hidden" id="foto-id">
                </div>
                
                <div class="form-group">
                    <label for="nome-cargo">Nome Completo *</label>
                     <input type="text" id="nome-cargo" class="form-control" required list="lista-membros">
                   </div> 
                
                <div class="form-group">
                    <label for="cargo">Cargo</label>
                    <input type="text" id="cargo" class="form-control" readonly>
                </div>
                
                <div class="form-group">
                    <label for="numero-membro-cargo">Número de Membro</label>
                    <input type="text" id="numero-membro-cargo" class="form-control" readonly>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn" id="btn-cancelar-cargo">Cancelar</button>
            <button type="button" class="btn btn-primary" id="btn-salvar-cargo">Salvar</button>
        </div>
    </div>
</div>

    <!-- Modal para Adicionar Novo Cargo -->
    <div id="modal-novo-cargo" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>Adicionar Novo Cargo</h2>
                <button id="btn-fechar-modal-novo-cargo" style="background: none; border: none; font-size: 20px; cursor: pointer;">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-novo-cargo">
                    <div class="form-group">
                        <label for="novo-nome-cargo">Nome do Cargo *</label>
                        <input type="text" id="novo-nome-cargo" class="form-control" placeholder="Ex: Coordenador de Marketing" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="novo-departamento-cargo">Departamento *</label>
                            <select id="novo-departamento-cargo" class="form-control" required onchange="atualizarCargosReferencia()">
                                <option value="">Selecione um departamento</option>
                                <option value="assembleia-geral">Assembleia Geral</option>
                                <option value="direcao-nacional">Direção Nacional</option>
                                <option value="secretaria-geral">Secretaria Geral</option>
                                <option value="conselho-fiscal">Conselho Fiscal</option>
                                <option value="conselho-consultivo">Conselho Consultivo</option>
                                <option value="planejamento-financas">Planejamento e Finanças</option>
                                <option value="juridico">Jurídico</option>
                                <option value="quadros-pessoal">Quadros e Pessoal</option>
                                <option value="comunicacao-imprensa">Comunicação Institucional e Imprensa</option>
                                <option value="cooperacao-intercambio">Cooperação e Intercâmbio</option>
                                <option value="formacao-estudos">Formação e Estudos Científicos</option>
                                <option value="regional-provincial">Regional ou Provincial</option>
                                <option value="conduta-disciplina">Conduta e Disciplina</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="novo-posicao-cargo">Posição no Departamento *</label>
                            <select id="novo-posicao-cargo" class="form-control" required onchange="atualizarCargosReferencia()">
                                <option value="">Selecione a posição</option>
                                <option value="acima">Acima (Superior)</option>
                                <option value="abaixo">Abaixo (Subordinado)</option>
                                <option value="mesmo-nivel">Mesmo Nível (Colega)</option>
                                <option value="primeiro">Primeiro Cargo do Departamento</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group" id="grupo-cargo-referencia" style="display: none;">
                        <label for="novo-cargo-referencia">Cargo de Referência *</label>
                        <select id="novo-cargo-referencia" class="form-control">
                            <option value="">Selecione um cargo de referência</option>
                        </select>
                        <small class="text-muted">Selecione em relação a qual cargo este novo cargo será posicionado</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="novo-descricao-cargo">Descrição do Cargo</label>
                        <textarea id="novo-descricao-cargo" class="form-control" rows="3" placeholder="Descreva as responsabilidades deste cargo"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="novo-nivel-hierarquia">Nível de Hierarquia</label>
                        <select id="novo-nivel-hierarquia" class="form-control">
                            <option value="1">Nível 1 (Direção)</option>
                            <option value="2">Nível 2 (Coordenação)</option>
                            <option value="3">Nível 3 (Técnico)</option>
                            <option value="4">Nível 4 (Auxiliar)</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" id="btn-cancelar-novo-cargo">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btn-salvar-novo-cargo">Adicionar Cargo</button>
            </div>
        </div>
    </div>

    <!-- Modal para Upload de Relatório -->
<div id="modal-upload-relatorio" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2>Upload de Relatório</h2>
            <button id="btn-fechar-modal-upload" style="background: none; border: none; font-size: 20px; cursor: pointer;">&times;</button>
        </div>
        <div class="modal-body">
            <form id="form-upload-relatorio">
                <div class="form-group">
                    <label for="relatorio-nome">Nome do Relatório *</label>
                    <input type="text" id="relatorio-nome" class="form-control" placeholder="Ex: Relatório Anual 2024" required>
                </div>
                
                <div class="form-group">
                    <label for="relatorio-tipo">Tipo de Relatório *</label>
                    <select id="relatorio-tipo" class="form-control" required>
                        <option value="">Selecione o tipo</option>
                        <option value="Relatório Mensal">Relatório Mensal</option>
                        <option value="Relatório Trimestral">Relatório Trimestral</option>
                        <option value="Relatório Anual">Relatório Anual</option>
                        <option value="Relatório de Actividades">Relatório de Actividades</option>
                        <option value="Relatório Financeiro">Relatório Financeiro</option>
                        <option value="Relatório de Progresso">Relatório de Progresso</option>
                        <option value="Relatório Técnico">Relatório Técnico</option>
                        <option value="Outro">Outro</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="relatorio-file">Ficheiro PDF *</label>
                    <input type="file" id="relatorio-file" class="form-control" accept=".pdf" required>
                    <small class="text-muted">Selecione o ficheiro PDF do relatório</small>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn" id="btn-cancelar-upload">Cancelar</button>
            <button type="button" class="btn btn-primary" id="btn-salvar-relatorio">
                <i class="fas fa-upload"></i> Fazer Upload
            </button>
        </div>
    </div>
</div>

    <script>
        // URL do Google Apps Script
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz6o2upGQqcevRrMjVzce-cfV6Ddi0x_PRkiWACHZejp-RVv18nEztGrgRqNJu31sPyVw/exec';
        
        // URL do Google Apps Script para candidaturas
        const CANDIDATURAS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwmddNGXvdBjU8VZfng30uunDK4OHArVURLz2tyIcJkZ4IMJqxZZEYxZM-yvSSlc6o6Ww/exec';

	// URL do Google Apps Script para relatórios (NOVA URL)
        const RELATORIOS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxT52lbMXfMcC0okdOxrq4JC_pZAyy8DBXasdUJd6SvQONJqH-hPf4omgiQj9_6v5nU/exec';

// Função para fazer requisições ao App Script de RELATÓRIOS
async function callAppScriptRelatorios(action, params = {}) {
    try {
        const formData = new FormData();
        formData.append('action', action);
        
        // Adicionar parâmetros ao FormData
        Object.keys(params).forEach(key => {
            formData.append(key, params[key]);
        });

        const response = await fetch(RELATORIOS_SCRIPT_URL, {
            method: 'POST',
            body: formData
        });

        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Erro na requisição:', error);
        return { success: false, message: 'Erro de conexão: ' + error.message };
    }
}

        // Dados dos membros
        let membros = JSON.parse(localStorage.getItem('membros')) || [];
        let currentFilters = {
            categoria: '',
            status: '',
            nome: ''
        };

        // Dados do organograma
        let organograma = JSON.parse(localStorage.getItem('organograma')) || {};
        let cargoAtual = '';

        // Dados dos relatórios
        let relatorios = JSON.parse(localStorage.getItem('relatorios')) || [];

        // Gráficos
        let membersChart, categoryChart;

        // ======= FUNÇÕES EXISTENTES =======

        // Função para corrigir o carregamento de fotos do Google Drive
        function corrigirCarregamentoFotos() {
            // Corrigir a foto da presidente
            const presidentPhoto = document.getElementById('presidentPhoto');
            if (presidentPhoto) {
                presidentPhoto.src = 'https://drive.google.com/thumbnail?id=1c38dXZUgqkgRKxkvI28phzKtGgaqVCov&sz=w400';
                presidentPhoto.onerror = function() {
                    this.src = '';
                    this.classList.add('photo-placeholder');
                    this.innerHTML = '?';
                };
            }
            
            // Corrigir todas as fotos do organograma
            const organogramaFotos = document.querySelectorAll('.org-photo[src*="drive.google.com"], .chefe-photo[src*="drive.google.com"]');
            organogramaFotos.forEach(foto => {
                const currentSrc = foto.src;
                if (currentSrc.includes('drive.google.com')) {
                    const match = currentSrc.match(/[&?]id=([^&]+)/) || currentSrc.match(/\/d\/([^\/]+)/);
                    if (match && match[1]) {
                        foto.src = `https://drive.google.com/thumbnail?id=${match[1]}&sz=w200`;
                    }
                }
            });
        }

        // Função para carregar foto da presidente
        function loadPresidentPhoto() {
            const img = document.getElementById('presidentPhoto');
            if (!img) return;
            
            // Usar a URL de thumbnail do Google Drive que funciona melhor
            img.src = 'https://drive.google.com/thumbnail?id=1c38dXZUgqkgRKxkvI28phzKtGgaqVCov&sz=w400';
            
            img.onerror = function() {
                console.log('Erro ao carregar foto da presidente, usando placeholder.');
                this.src = '';
                this.classList.add('photo-placeholder');
                this.innerHTML = '?';
            };
            
            img.onload = function() {
                console.log('Foto da presidente carregada com sucesso');
                this.classList.remove('photo-placeholder');
            };
        }

        // Função para carregar categorias dinamicamente no filtro
        function carregarCategoriasFiltro() {
            const selectCategoria = document.getElementById('filter-categoria');
            
            // Limpar opções existentes (exceto a primeira)
            while (selectCategoria.children.length > 1) {
                selectCategoria.removeChild(selectCategoria.lastChild);
            }
            
            // Obter categorias únicas dos membros
            const categoriasUnicas = [...new Set(membros.map(m => m.categoria).filter(Boolean))].sort();
            
            console.log('Categorias únicas encontradas:', categoriasUnicas);
            
            // Adicionar cada categoria ao select
            categoriasUnicas.forEach(categoria => {
                const option = document.createElement('option');
                option.value = categoria;
                option.textContent = categoria;
                selectCategoria.appendChild(option);
            });
        }

        // Função para sincronizar com o Google Sheets
        async function sincronizarComSheets() {
            try {
                console.log('Sincronizando com Google Sheets...');
                
                const timestamp = new Date().getTime();
                const response = await fetch(`${SCRIPT_URL}?action=getMembers&t=${timestamp}`);
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('Dados recebidos:', result);
                
                if (result.success && result.members) {
                    membros = result.members.map((membro, index) => {
                        // Corrigir status "Dvida" para "Dívida"
                        let status = membro.status || 'Regular';
                        if (status === 'Dvida') {
                            status = 'Dívida';
                        }
                        
                        return {
                            id: index + 1,
                            nome: membro.nome || '',
                            categoria: membro.categoria || '',
                            dataAdmissao: membro.dataAdmissao || '',
                            numeroMembro: membro.numeroMembro || '',
                            status: status,
                            ultimoPagamento: membro.ultimoPagamento || '',
                            bi: membro.bi || '',
                            telefone: membro.telefone || '',
                            email: membro.email || '',
                            empresa: membro.empresa || '',
                            cargo: membro.cargo || '',
                            endereco: membro.endereco || '',
                            dataNascimento: membro.dataNascimento || '',
                            nacionalidade: membro.nacionalidade || ''
                        };
                    });
                    
                    salvarMembros();
                    console.log(`${membros.length} membros carregados`);
                    
                    // Carregar categorias dinamicamente
                    carregarCategoriasFiltro();
                    
                    carregarTabelaMembros();
                    atualizarResumo();
                    atualizarGraficos();
                } else {
                    console.warn('Nenhum membro encontrado');
                }
            } catch (error) {
                console.error('Erro na sincronização:', error);
                carregarTabelaMembros();
                atualizarResumo();
            }
        }

        // Função para buscar o total de candidaturas da dashboard de candidaturas
        async function carregarTotalCandidaturas() {
            try {
                const response = await fetch(`${CANDIDATURAS_SCRIPT_URL}?action=getDashboardStats`);
                const result = await response.json();
                
                if (result.success && result.stats) {
                    return result.stats.total || 0;
                } else {
                    console.warn('Não foi possível obter o total de candidaturas:', result.message);
                    return 0;
                }
            } catch (error) {
                console.error('Erro ao carregar total de candidaturas:', error);
                return 0;
            }
        }

        // Função para salvar membros no localStorage
        function salvarMembros() {
            localStorage.setItem('membros', JSON.stringify(membros));
        }

        // Função para salvar relatórios no localStorage
        function salvarRelatorios() {
            localStorage.setItem('relatorios', JSON.stringify(relatorios));
        }

        // Função para atualizar o resumo
        async function atualizarResumo() {
            const totalMembros = membros.length;
            document.getElementById('total-membros').textContent = totalMembros;
            
            const regulares = membros.filter(m => m.status === 'Regular').length;
            document.getElementById('membros-regulares').textContent = regulares;
            
            const inadimplentes = membros.filter(m => m.status === 'Dívida').length;
            document.getElementById('membros-inadimplentes').textContent = inadimplentes;
            
            // Carregar total REAL de candidaturas
            const totalCandidaturas = await carregarTotalCandidaturas();
            document.getElementById('total-candidaturas').textContent = totalCandidaturas;
            
            // Calcular percentagens (mantidas como simuladas)
            const percentTotal = totalMembros > 0 ? ((Math.random() * 5) + 1).toFixed(1) : 0;
            const percentRegulares = regulares > 0 ? ((Math.random() * 4) + 1).toFixed(1) : 0;
            const percentInadimplentes = inadimplentes > 0 ? ((Math.random() * 3) + 1).toFixed(1) : 0;
            const percentCandidaturas = totalCandidaturas > 0 ? ((Math.random() * 10) + 1).toFixed(1) : 0;
            
            // Atualizar percentagens
            document.getElementById('percent-total').textContent = `${percentTotal}%`;
            document.getElementById('percent-regulares').textContent = `${percentRegulares}%`;
            document.getElementById('percent-inadimplentes').textContent = `${percentInadimplentes}%`;
            document.getElementById('percent-candidaturas').textContent = `${percentCandidaturas}%`;
            
            atualizarMembrosRecentes();
        }

        // Função para atualizar membros recentes
        function atualizarMembrosRecentes() {
            const tbody = document.getElementById('corpo-tabela-membros-recentes');
            tbody.innerHTML = '';
            
            const recentes = [...membros]
                .sort((a, b) => new Date(b.dataAdmissao) - new Date(a.dataAdmissao))
                .slice(0, 5);
            
            recentes.forEach(membro => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${membro.nome}</td>
                    <td>${membro.categoria}</td>
                    <td>${formatarData(membro.dataAdmissao)}</td>
                    <td>${membro.numeroMembro}</td>
                    <td><span class="status ${membro.status.toLowerCase().replace('í', 'i').replace(' ', '-')}">${membro.status}</span></td>
                    <td class="action-buttons">
                        <button class="action-btn view" onclick="verMembro(${membro.id})"><i class="fas fa-eye"></i></button>
                        <button class="action-btn edit" onclick="editarMembro(${membro.id})"><i class="fas fa-edit"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Função para formatar data
        function formatarData(dataString) {
            if (!dataString) return '';
            const data = new Date(dataString);
            if (isNaN(data.getTime())) return dataString;
            
            const dia = String(data.getDate()).padStart(2, '0');
            const mes = String(data.getMonth() + 1).padStart(2, '0');
            const ano = data.getFullYear();
            return `${dia}/${mes}/${ano}`;
        }

        // Função para carregar a tabela de membros
        function carregarTabelaMembros() {
            const tbody = document.getElementById('corpo-tabela-membros');
            tbody.innerHTML = '';
            
            let membrosFiltrados = [...membros];
            
            // Aplicar filtros
            if (currentFilters.categoria) {
                membrosFiltrados = membrosFiltrados.filter(m => m.categoria === currentFilters.categoria);
            }
            
            if (currentFilters.status) {
                membrosFiltrados = membrosFiltrados.filter(m => m.status === currentFilters.status);
            }
            
            if (currentFilters.nome) {
                const termoBusca = currentFilters.nome.toLowerCase();
                membrosFiltrados = membrosFiltrados.filter(m => 
                    m.nome.toLowerCase().includes(termoBusca)
                );
            }
            
            // Renderizar tabela
            if (membrosFiltrados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Nenhum membro encontrado</td></tr>';
            } else {
                membrosFiltrados.forEach(membro => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${membro.nome}</td>
                        <td>${membro.categoria}</td>
                        <td>${formatarData(membro.dataAdmissao)}</td>
                        <td>${membro.numeroMembro}</td>
                        <td><span class="status ${membro.status.toLowerCase().replace('í', 'i').replace(' ', '-')}">${membro.status}</span></td>
                        <td class="action-buttons">
                            <button class="action-btn view" onclick="verMembro(${membro.id})"><i class="fas fa-eye"></i></button>
                            <button class="action-btn edit" onclick="editarMembro(${membro.id})"><i class="fas fa-edit"></i></button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            }
        }

        // Função para abrir modal de edição
        function abrirModal(membro) {
            document.getElementById('membro-id').value = membro.id;
            document.getElementById('nome').value = membro.nome;
            document.getElementById('numero-membro').value = membro.numeroMembro;
            document.getElementById('categoria').value = membro.categoria;
            document.getElementById('telefone').value = membro.telefone;
            document.getElementById('status').value = membro.status;
            
            // Configurar botões de pagamento
            if (membro.status === 'Dívida') {
                document.getElementById('btn-em-divida').style.display = 'inline-block';
                document.getElementById('info-pagamento').innerHTML = '<i class="fas fa-exclamation-triangle" style="color: var(--danger);"></i> Este membro está em dívida';
            } else {
                document.getElementById('btn-em-divida').style.display = 'none';
                document.getElementById('info-pagamento').innerHTML = '<i class="fas fa-check" style="color: var(--success);"></i> Pagamento em dia';
            }
            
            document.getElementById('modal-membro').style.display = 'flex';
        }

        // Função para fechar modal
        function fecharModal() {
            document.getElementById('modal-membro').style.display = 'none';
            document.getElementById('modal-ver-membro').style.display = 'none';
            document.getElementById('modal-upload-relatorio').style.display = 'none';
        }

        // Função para salvar membro
        async function salvarMembro() {
            const id = document.getElementById('membro-id').value;
            const status = document.getElementById('status').value;
            
            const membro = membros.find(m => m.id == id);
            if (membro) {
                membro.status = status;
                
                // Atualizar no Google Sheets
                await atualizarMembroNoSheets(membro);
                
                salvarMembros();
                carregarTabelaMembros();
                atualizarResumo();
                atualizarGraficos();
                fecharModal();
                
                alert('Membro atualizado com sucesso!');
            }
        }

        // Função para marcar pagamento
        async function marcarPagamento() {
            const id = document.getElementById('membro-id').value;
            const membro = membros.find(m => m.id == id);
            
            if (membro) {
                const hoje = new Date().toISOString().split('T')[0];
                membro.ultimoPagamento = hoje;
                membro.status = 'Regular';
                
                await atualizarMembroNoSheets(membro);
                
                salvarMembros();
                carregarTabelaMembros();
                atualizarResumo();
                atualizarGraficos();
                fecharModal();
                
                alert('Pagamento registrado com sucesso!');
            }
        }

        // Função para atualizar no Google Sheets
        async function atualizarMembroNoSheets(membro) {
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `action=updateMember&memberData=${JSON.stringify({
                        numeroMembro: membro.numeroMembro,
                        ultimoPagamento: membro.ultimoPagamento,
                        status: membro.status
                    })}`
                });
                
                const result = await response.json();
                if (!result.success) {
                    console.error('Erro ao atualizar:', result.message);
                }
            } catch (error) {
                console.error('Erro na atualização:', error);
            }
        }

        // Função para editar membro
        function editarMembro(id) {
            const membro = membros.find(m => m.id === id);
            if (membro) {
                abrirModal(membro);
            }
        }

        // Função para ver detalhes do membro
        function verMembro(id) {
            const membro = membros.find(m => m.id === id);
            if (membro) {
                const modalCorpo = document.getElementById('modal-ver-corpo');
                modalCorpo.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label><strong>Nome Completo</strong></label>
                            <div>${membro.nome || 'Não informado'}</div>
                        </div>
                        <div class="form-group">
                            <label><strong>Número de Membro</strong></label>
                            <div>${membro.numeroMembro || 'Não informado'}</div>
                        </div>
                        <div class="form-group">
                            <label><strong>Categoria</strong></label>
                            <div>${membro.categoria || 'Não informado'}</div>
                        </div>
                        <div class="form-group">
                            <label><strong>Status</strong></label>
                            <div><span class="status ${membro.status.toLowerCase().replace('í', 'i').replace(' ', '-')}">${membro.status}</span></div>
                        </div>
                        <div class="form-group">
                            <label><strong>Data de Admissão</strong></label>
                            <div>${formatarData(membro.dataAdmissao) || 'Não informado'}</div>
                        </div>
                        <div class="form-group">
                            <label><strong>BI/Passaporte</strong></label>
                            <div>${membro.bi || 'Não informado'}</div>
                        </div>
                        <div class="form-group">
                            <label><strong>Telefone</strong></label>
                            <div>${membro.telefone || 'Não informado'}</div>
                        </div>
                        <div class="form-group">
                            <label><strong>E-mail</strong></label>
                            <div>${membro.email || 'Não informado'}</div>
                        </div>
                        <div class="form-group">
                            <label><strong>Empresa/Instituição</strong></label>
                            <div>${membro.empresa || 'Não informado'}</div>
                        </div>
                        <div class="form-group">
                            <label><strong>Cargo/Função</strong></label>
                            <div>${membro.cargo || 'Não informado'}</div>
                        </div>
                        <div class="form-group">
                            <label><strong>Endereço</strong></label>
                            <div>${membro.endereco || 'Não informado'}</div>
                        </div>
                        <div class="form-group">
                            <label><strong>Data de Nascimento</strong></label>
                            <div>${formatarData(membro.dataNascimento) || 'Não informado'}</div>
                        </div>
                        <div class="form-group">
                            <label><strong>Nacionalidade</strong></label>
                            <div>${membro.nacionalidade || 'Não informado'}</div>
                        </div>
                        <div class="form-group">
                            <label><strong>Último Pagamento</strong></label>
                            <div>${formatarData(membro.ultimoPagamento) || 'Não registrado'}</div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modal-ver-membro').style.display = 'flex';
            }
        }

        // Função para alternar entre páginas - VERSÃO CORRIGIDA E ESTÁVEL
        function alternarPagina(pagina) {
            console.log('=== ALTERNANDO PÁGINA: ' + pagina + ' ===');
            
            // Oculta todas as seções de conteúdo PRINCIPAL
            const secoesPrincipais = [
                'resumo-content',
                'gestao-membros-content', 
                'organograma-content',
                'chefes-content',
                'relatorios-content',
                'projectos-content'
            ];
            
            secoesPrincipais.forEach(secao => {
                const elemento = document.getElementById(secao);
                if (elemento) {
                    elemento.style.display = 'none';
                }
            });

            // Remove a classe active de todos os itens do menu
            document.querySelectorAll('.sidebar-menu a').forEach(item => {
                item.classList.remove('active');
            });

            // Mostra a seção correspondente
            if (pagina === 'resumo') {
                document.getElementById('resumo-content').style.display = 'block';
                document.querySelector('[data-page="resumo"]').classList.add('active');
                if (typeof atualizarResumo === 'function') atualizarResumo();
                if (typeof atualizarGraficos === 'function') atualizarGraficos();
            } 
            else if (pagina === 'gestao-membros') {
                document.getElementById('gestao-membros-content').style.display = 'block';
                document.querySelector('[data-page="gestao-membros"]').classList.add('active');
                if (typeof carregarTabelaMembros === 'function') carregarTabelaMembros();
                if (typeof carregarCategoriasFiltro === 'function') carregarCategoriasFiltro();
            } 
            else if (pagina === 'organograma') {
    document.getElementById('organograma-content').style.display = 'block';
    document.querySelector('[data-page="organograma"]').classList.add('active');
    
    // Mostrar aviso de desenvolvimento
    alert('🚧 Organograma em Desenvolvimento\n\nEsta funcionalidade está sendo desenvolvida e estará disponível em breve!');
}
 
            else if (pagina === 'relatorios') {
                document.getElementById('relatorios-content').style.display = 'block';
                document.querySelector('[data-page="relatorios"]').classList.add('active');
                if (typeof carregarRelatorios === 'function') carregarRelatorios();
                console.log('✅ Página Relatórios ativada');
            } 
            else if (pagina === 'projectos') {
                console.log('Abrindo página de projetos...');
                document.getElementById('projectos-content').style.display = 'block';
                document.querySelector('[data-page="projectos"]').classList.add('active');
                
                setTimeout(() => {
                    if (typeof inicializarPaginaProjetos === 'function') {
                        inicializarPaginaProjetos();
                    }
                }, 100);
            }
        }

// ======= FUNÇÃO DE UPLOAD DE FOTO PARA O ORGANOGRAMA =======
// ======= FUNÇÃO DE UPLOAD DE FOTO PARA O ORGANOGRAMA - VERSÃO CORRIGIDA =======
async function uploadFotoOrganograma() {
    const fileInput = document.getElementById('foto-upload');
    const file = fileInput.files[0];
    
    if (!file) {
        alert('Por favor, selecione uma imagem.');
        return null;
    }

    // Verificar tamanho do arquivo (máximo 5MB)
    if (file.size > 5 * 1024 * 1024) {
        alert('A imagem é muito grande. Tamanho máximo: 5MB');
        return null;
    }

    // Mostrar loading no botão
    const btnUpload = document.getElementById('btn-upload-foto');
    const originalText = btnUpload.innerHTML;
    btnUpload.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Carregando...';
    btnUpload.disabled = true;

    try {
        // Converter arquivo para base64
        const base64Data = await fileToBase64(file);
        console.log('✅ Imagem convertida para base64, tamanho:', base64Data.length);
        
        const UPLOAD_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwQQmpVqwZDm24LrOQlB7KnnpONlAcAQmKwizn6xaMlxBOJGUVJ-VrRIvCPHY-Ut9uf/exec';
        
        console.log('📤 Enviando imagem real para:', UPLOAD_SCRIPT_URL);
        console.log('🔧 Cargo atual:', cargoAtual);
        
        const params = new URLSearchParams();
        params.append('action', 'uploadImage');
        params.append('imageData', base64Data);
        params.append('fileName', file.name);
        params.append('cargoId', cargoAtual);

        const response = await fetch(UPLOAD_SCRIPT_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: params.toString()
        });

        const data = await response.json();
        console.log('📨 Resposta do GAS:', data);
        
        if (data.success) {
            document.getElementById('foto-id').value = data.fileId;
            document.getElementById('photo-preview').src = data.thumbnailUrl;
            
            if (organograma[cargoAtual]) {
                organograma[cargoAtual].fotoId = data.fileId;
                localStorage.setItem('organograma', JSON.stringify(organograma));
            }
            
            alert('✅ Foto carregada com sucesso!');
            return data.fileId;
        } else {
            throw new Error(data.message);
        }
        
    } catch (error) {
        console.error('❌ Erro no upload:', error);
        alert('❌ Erro ao carregar foto: ' + error.message);
        return null;
    } finally {
        // Restaurar botão
        btnUpload.innerHTML = originalText;
        btnUpload.disabled = false;
    }
}

// Função auxiliar para converter arquivo para base64 - CORRIGIDA
function fileToBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
            // ✅ CORREÇÃO: Retornar apenas a parte base64 (sem o prefixo data:image/jpeg;base64,)
            const result = reader.result;
            const base64 = result.split(',')[1];
            resolve(base64);
        };
        reader.onerror = error => reject(error);
        reader.readAsDataURL(file);
    });
}



// Função para preencher a lista de membros para autocomplete - VERSÃO CORRIGIDA
function preencherListaMembros() {
    console.log('🔄 Iniciando preencherListaMembros...');
    
    const datalist = document.getElementById('lista-membros');
    if (!datalist) {
        console.error('❌ ERRO: datalist não encontrado!');
        return;
    }
    
    // LIMPAR completamente
    datalist.innerHTML = '';
    console.log('✅ Datalist limpo');
    
    // VERIFICAR se membros existe e tem dados
    if (!membros || !Array.isArray(membros) || membros.length === 0) {
        console.warn('⚠️ AVISO: Nenhum membro encontrado ou array vazio');
        console.log('membros:', membros);
        return;
    }
    
    console.log(`📝 Encontrados ${membros.length} membros`);
    
    // ADICIONAR cada membro
    let optionsAdicionadas = 0;
    membros.forEach((membro, index) => {
        if (membro && membro.nome && membro.nome.trim() !== '') {
            const option = document.createElement('option');
            option.value = membro.nome.trim();
            option.textContent = membro.nome.trim();
            datalist.appendChild(option);
            optionsAdicionadas++;
        }
    });
    
    console.log(`✅ ${optionsAdicionadas} opções adicionadas ao datalist`);
    console.log('📋 Conteúdo do datalist:', datalist.innerHTML);
}

// Função para atualizar a pré-visualização (SIMPLIFICADA - sem URL)
function atualizarPreviewFoto() {
    const fotoId = document.getElementById('foto-id').value;
    const photoPreview = document.getElementById('photo-preview');
    
    if (fotoId && fotoId.trim() !== '') {
        // Usar apenas o ID do Google Drive
        const thumbnailUrl = `https://drive.google.com/thumbnail?id=${fotoId}&sz=w200`;
        photoPreview.src = thumbnailUrl;
        
        photoPreview.onerror = function() {
            this.src = '';
            this.classList.add('placeholder');
            this.innerHTML = '?';
        };
        photoPreview.onload = function() {
            this.classList.remove('placeholder');
        };
    } else {
        photoPreview.src = '';
        photoPreview.classList.add('placeholder');
        photoPreview.innerHTML = '?';
    }
}

// Função para editar cargo (MANTENDO AUTCOMPLETE)
function editarCargo(posicao) {
    console.log('🎯 editarCargo chamado para:', posicao);
    
    cargoAtual = posicao;
    const dados = organograma[posicao] || {};
    const cartao = document.querySelector(`[data-position="${posicao}"]`);
    const cargoNome = cartao.querySelector('.org-position').textContent;
    
    document.getElementById('modal-titulo-cargo').textContent = `Editar ${cargoNome}`;
    document.getElementById('cargo').value = cargoNome;
    
    // Usar o campo oculto para o ID da foto
    document.getElementById('foto-id').value = dados.fotoId || '';
    document.getElementById('nome-cargo').value = dados.nome || '';
    document.getElementById('numero-membro-cargo').value = dados.numeroMembro || '';
    
    console.log('📋 Dados do cargo:', dados);
    
    // Preencher a lista de membros para autocomplete
    console.log('🔄 Chamando preencherListaMembros...');
    preencherListaMembros();
    
    // Limpar o input de arquivo
    document.getElementById('foto-upload').value = '';
    
    // Atualizar pré-visualização
    atualizarPreviewFoto();
    
    document.getElementById('modal-cargo').style.display = 'flex';
    
    console.log('✅ Modal aberto');
}


// Função para autocompletar número do membro quando nome é selecionado
function configurarAutocompleteNome() {
    const nomeInput = document.getElementById('nome-cargo');
    
    nomeInput.addEventListener('input', function() {
        const nome = this.value;
        const membro = membros.find(m => m.nome === nome);
        
        if (membro) {
            document.getElementById('numero-membro-cargo').value = membro.numeroMembro;
        } else {
            document.getElementById('numero-membro-cargo').value = '';
        }
    });
}

        // ======= GRÁFICOS =======
        function inicializarGraficos() {
            // Gráfico de evolução mensal de novos membros
            const membersCtx = document.getElementById('membersChart').getContext('2d');
            membersChart = new Chart(membersCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false // Remover legenda
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, ticks: { stepSize: 1 } }
                    }
                }
            });

            // Gráfico de distribuição por categoria
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            categoryChart = new Chart(categoryCtx, {
                type: 'pie',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#1a4e8e', '#28a745', '#ffc107', '#6f42c1', '#dc3545',
                            '#fd7e14', '#20c997', '#e83e8c', '#6c757d', '#0dcaf0'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            top: 20, // Subir a pizza dentro do cartão
                            bottom: 40 // Espaço para as legendas
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            display: true,
                            labels: {
                                boxWidth: 12,
                                font: {
                                    size: 11
                                },
                                padding: 15
                            }
                        }
                    }
                }
            });
        }

        // Função para atualizar gráficos com dados reais
        function atualizarGraficos() {
            if (!membersChart || !categoryChart) return;
            if (!membros || membros.length === 0) return;

            // Atualizar gráfico de distribuição por categoria
            const categoriasCount = {};
            membros.forEach(membro => {
                const categoria = membro.categoria || 'Não Definida';
                categoriasCount[categoria] = (categoriasCount[categoria] || 0) + 1;
            });

            categoryChart.data.labels = Object.keys(categoriasCount);
            categoryChart.data.datasets[0].data = Object.values(categoriasCount);
            categoryChart.update();

            // Atualizar gráfico de evolução mensal de novos membros
            const meses = ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];
            const anoAtual = new Date().getFullYear();
            const dadosPorCategoria = {};

            membros.forEach(membro => {
                if (membro.dataAdmissao) {
                    const data = new Date(membro.dataAdmissao);
                    if (!isNaN(data) && data.getFullYear() === anoAtual) {
                        const mes = data.getMonth();
                        const categoria = membro.categoria || 'Não Definida';
                        if (!dadosPorCategoria[categoria]) dadosPorCategoria[categoria] = Array(12).fill(0);
                        dadosPorCategoria[categoria][mes]++;
                    }
                }
            });

            const cores = [
                '#1a4e8e', '#28a745', '#ffc107', '#6f42c1', '#dc3545',
                '#fd7e14', '#20c997', '#e83e8c', '#6c757d', '#0dcaf0'
            ];

            const datasets = [];
            let corIndex = 0;

            for (const [categoria, dados] of Object.entries(dadosPorCategoria)) {
                datasets.push({
                    label: categoria,
                    data: dados,
                    backgroundColor: cores[corIndex % cores.length] + '20',
                    borderColor: cores[corIndex % cores.length],
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4
                });
                corIndex++;
            }

            datasets.sort((a, b) => b.data.reduce((s, v) => s + v, 0) - a.data.reduce((s, v) => s + v, 0));

            membersChart.data.datasets = datasets;
            membersChart.update();
        }

        // ======= FUNÇÕES DO ORGANOGRAMA =======
        // Função para carregar dados do organograma
        function carregarOrganograma() {
            const cartoes = document.querySelectorAll('.org-card');
            
            cartoes.forEach(cartao => {
                const posicao = cartao.getAttribute('data-position');
                const dados = organograma[posicao] || {};
                
                // Atualizar imagem - CORREÇÃO: Usar thumbnail do Google Drive
                const img = cartao.querySelector('.org-photo');
                if (dados.fotoId && dados.fotoId.trim() !== '') {
                    img.src = `https://drive.google.com/thumbnail?id=${dados.fotoId}&sz=w200`;
                    img.onerror = function() {
                        this.src = '';
                        this.classList.add('placeholder');
                        this.innerHTML = '?';
                    };
                    img.onload = function() {
                        this.classList.remove('placeholder');
                    };
                    img.classList.remove('placeholder');
                    img.innerHTML = '';
                } else {
                    img.src = '';
                    img.classList.add('placeholder');
                    img.innerHTML = '?';
                }
                
                // Atualizar nome
                const nomeElement = cartao.querySelector('.org-name');
                if (dados.nome) {
                    nomeElement.textContent = dados.nome;
                    cartao.classList.remove('vaga');
                } else {
                    nomeElement.textContent = 'Vaga disponível';
                    cartao.classList.add('vaga');
                }
                
                // Atualizar número de membro
                const numeroElement = cartao.querySelector('.member-id');
                if (dados.numeroMembro) {
                    numeroElement.textContent = dados.numeroMembro;
                } else {
                    numeroElement.textContent = '---';
                }
            });
        }

        

        // Função para salvar cargo
        function salvarCargo() {
            const nome = document.getElementById('nome-cargo').value;
            const fotoId = document.getElementById('foto-id').value;
            
            if (!nome.trim()) {
                alert('O nome é obrigatório!');
                return;
            }
            
            // Buscar membro pelo nome
            const membro = membros.find(m => m.nome === nome);
            
            if (!membro) {
                alert('Membro não encontrado! Verifique se o nome está correto.');
                return;
            }
            
            // CORREÇÃO: Salvar apenas o ID do Google Drive
            organograma[cargoAtual] = {
                nome: nome,
                fotoId: fotoId,
                numeroMembro: membro.numeroMembro
            };
            
            // Salvar no localStorage
            localStorage.setItem('organograma', JSON.stringify(organograma));
            
            // Atualizar visualização
            carregarOrganograma();
            
            // Fechar modal
            fecharModalCargo();
            
            alert('Cargo atualizado com sucesso!');
        }

        // Função para fechar modal do cargo
        function fecharModalCargo() {
            document.getElementById('modal-cargo').style.display = 'none';
        }

        // Função para abrir modal de novo cargo
        function abrirModalNovoCargo() {
            document.getElementById('modal-novo-cargo').style.display = 'flex';
        }

        // Função para fechar modal de novo cargo
        function fecharModalNovoCargo() {
            document.getElementById('modal-novo-cargo').style.display = 'none';
            document.getElementById('form-novo-cargo').reset();
        }

        // Função para salvar novo cargo
        function salvarNovoCargo() {
            const nomeCargo = document.getElementById('novo-nome-cargo').value;
            const departamento = document.getElementById('novo-departamento-cargo').value;
            const descricao = document.getElementById('novo-descricao-cargo').value;
            
            if (!nomeCargo.trim() || !departamento) {
                alert('Nome do cargo e departamento são obrigatórios!');
                return;
            }
            
            // Em uma implementação real, aqui seria feita a lógica para adicionar o novo cargo
            // Para este exemplo, apenas simularemos a adição
            alert(`Novo cargo "${nomeCargo}" adicionado ao departamento ${departamento} com sucesso!`);
            
            // Fechar modal
            fecharModalNovoCargo();
        }

        // Função para mostrar todos os chefes
        function verTodosChefes() {
            // Ocultar organograma e mostrar seção de chefes
            document.getElementById('organograma-content').style.display = 'none';
            document.getElementById('chefes-content').style.display = 'block';
            
            carregarChefes();
        }

        // Função para carregar a lista de chefes
        function carregarChefes() {
            const chefesGrid = document.getElementById('chefes-grid');
            chefesGrid.innerHTML = '';
            
            // Definir quais cargos são considerados "chefes"
            const cargosChefes = [
                'presidente-assembleia',
                'presidente-nacional',
                'vice-presidente-nacional',
                'presidente-fiscal',
                'coordenador-financeiro',
                'chefe-departamento-juridico',
                'chefe-departamento-quadros',
                'chefe-departamento-comunicacao',
                'chefe-departamento-cooperacao',
                'chefe-departamento-formacao',
                'chefe-departamento-regional',
                'chefe-departamento-conduta',
                'chefe-seccao-quadros',
                'chefe-seccao-cooperacao',
                'chefe-seccao-regional'
            ];
            
            cargosChefes.forEach(posicao => {
                const cartao = document.querySelector(`[data-position="${posicao}"]`);
                if (cartao) {
                    const dados = organograma[posicao] || {};
                    const nome = dados.nome || cartao.querySelector('.org-name').textContent;
                    const cargo = cartao.querySelector('.org-position').textContent;
                    const numeroMembro = dados.numeroMembro || cartao.querySelector('.member-id').textContent;
                    const fotoId = dados.fotoId;
                    
                    // Determinar o departamento baseado na posição
                    let departamento = 'Direção Nacional';
                    if (posicao.includes('assembleia')) departamento = 'Assembleia Geral';
                    if (posicao.includes('fiscal')) departamento = 'Conselho Fiscal';
                    if (posicao.includes('financeiro')) departamento = 'Planejamento e Finanças';
                    if (posicao.includes('juridico')) departamento = 'Departamento Jurídico';
                    if (posicao.includes('quadros') && posicao.includes('chefe-departamento')) departamento = 'Pessoal e Quadros';
                    if (posicao.includes('comunicacao')) departamento = 'Comunicação Institucional';
                    if (posicao.includes('cooperacao') && posicao.includes('chefe-departamento')) departamento = 'Intercâmbio e Cooperação';
                    if (posicao.includes('formacao')) departamento = 'Formação e Estudos';
                    if (posicao.includes('regional') && posicao.includes('chefe-departamento')) departamento = 'Regional/Provincial';
                    if (posicao.includes('conduta')) departamento = 'Conduta e Disciplina';
                    if (posicao.includes('chefe-seccao')) departamento = departamento + ' - Secção';
                    
                    const chefeCard = document.createElement('div');
                    chefeCard.className = 'chefe-card';
                    
                    // Construir a URL da foto ou usar placeholder
                    let fotoHTML = '';
                    if (fotoId && fotoId.trim() !== '') {
                        fotoHTML = `<img src="https://drive.google.com/thumbnail?id=${fotoId}&sz=w200" class="chefe-photo" alt="Foto do ${nome}" onerror="this.classList.add('placeholder'); this.innerHTML='?'" onload="this.classList.remove('placeholder')">`;
                    } else {
                        fotoHTML = '<div class="chefe-photo placeholder">?</div>';
                    }
                    
                    chefeCard.innerHTML = `
                        ${fotoHTML}
                        <div class="chefe-nome">${nome}</div>
                        <div class="chefe-cargo">${cargo}</div>
                        <div class="chefe-departamento">${departamento}</div>
                        <div class="chefe-id">Nº: ${numeroMembro}</div>
                    `;
                    
                    chefesGrid.appendChild(chefeCard);
                }
            });
        }

        // Função para exportar organograma como PDF
        async function exportarOrganograma() {
            try {
                // Mostrar mensagem de processamento
                const btnExportar = document.getElementById('btn-exportar-organograma');
                const originalText = btnExportar.innerHTML;
                btnExportar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Gerando PDF...';
                btnExportar.disabled = true;
                
                const { jsPDF } = window.jspdf;
                const organogramaContainer = document.querySelector('.organograma-container');
                
                // Usar html2canvas para capturar o organograma
                const canvas = await html2canvas(organogramaContainer, {
                    scale: 2, // Maior qualidade
                    useCORS: true,
                    logging: false,
                    scrollX: 0,
                    scrollY: -window.scrollY
                });
                
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 190; // Largura A4 em mm (com margens)
                const pageHeight = 280; // Altura A4 em mm (com margens)
                const imgHeight = canvas.height * imgWidth / canvas.width;
                
                let heightLeft = imgHeight;
                let position = 10; // Margem superior
                
                // Adicionar título
                pdf.setFontSize(20);
                pdf.setTextColor(26, 78, 142); // Cor primária
                pdf.text('ORGANOGRAMA - AGETRHA', 105, 15, { align: 'center' });
                
                pdf.setFontSize(12);
                pdf.setTextColor(100, 100, 100);
                pdf.text('Departamento de Pessoal e Quadros', 105, 22, { align: 'center' });
                
                position = 30; // Começar após o título
                
                // Adicionar a imagem
                pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                // Adicionar páginas adicionais se necessário
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight + 30;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                // Salvar o PDF
                pdf.save('organograma-agetrha.pdf');
                
                // Restaurar botão
                btnExportar.innerHTML = originalText;
                btnExportar.disabled = false;
                
            } catch (error) {
                console.error('Erro ao exportar PDF:', error);
                alert('Erro ao exportar o organograma. Tente novamente.');
                
                // Restaurar botão em caso de erro
                const btnExportar = document.getElementById('btn-exportar-organograma');
                btnExportar.innerHTML = '<i class="fas fa-download"></i> Exportar';
                btnExportar.disabled = false;
            }
        }

        // Função para mostrar/ocultar departamentos
        function toggleDepartamentos() {
            const container = document.getElementById('departamentos-container');
            const btn = document.getElementById('btn-ver-departamentos');
            
            if (container.style.display === 'none') {
                container.style.display = 'block';
                btn.innerHTML = '<i class="fas fa-chevron-up"></i> OCULTAR DEPARTAMENTOS';
            } else {
                container.style.display = 'none';
                btn.innerHTML = '<i class="fas fa-chevron-down"></i> VER DEPARTAMENTOS';
            }
        }

        // ======= FUNÇÕES AUXILIARES PARA FOTOS =======
        // Função para atualizar a pré-visualização da foto
        function atualizarPreviewFoto() {
            const fotoId = document.getElementById('foto-id').value;
            const photoPreview = document.getElementById('photo-preview');
            
            if (fotoId && fotoId.trim() !== '') {
                photoPreview.src = `https://drive.google.com/thumbnail?id=${fotoId}&sz=w200`;
                photoPreview.onerror = function() {
                    this.src = '';
                    this.classList.add('placeholder');
                    this.innerHTML = '?';
                };
                photoPreview.onload = function() {
                    this.classList.remove('placeholder');
                };
                photoPreview.classList.remove('placeholder');
                photoPreview.innerHTML = '';
            } else {
                photoPreview.src = '';
                photoPreview.classList.add('placeholder');
                photoPreview.innerHTML = '?';
            }
        }

        // Função para testar se a foto está carregando corretamente
        function testarFoto() {
            const fotoId = document.getElementById('foto-id').value;
            if (!fotoId) {
                alert('Por favor, insira um ID de foto primeiro.');
                return;
            }
            
            const testImg = new Image();
            testImg.onload = function() {
                alert('✓ Foto carregada com sucesso!');
                atualizarPreviewFoto(); // Atualizar o preview
            };
            testImg.onerror = function() {
                alert('✗ Erro ao carregar foto. Verifique o ID.');
            };
            testImg.src = `https://drive.google.com/thumbnail?id=${fotoId}&sz=w200`;
        }

        // ======= FUNÇÕES DOS RELATÓRIOS =======
// Função para carregar relatórios do App Script
async function carregarRelatorios() {
    const relatoriosGrid = document.getElementById('relatorios-grid');
    relatoriosGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--gray);"><i class="fas fa-spinner fa-spin" style="font-size: 50px; margin-bottom: 15px;"></i><p>Carregando relatórios...</p></div>';

    try {
        const result = await callAppScriptRelatorios('getPDFs');
        
        if (result.success) {
            relatorios = result.pdfs || [];
            exibirRelatorios();
        } else {
            throw new Error(result.message);
        }
    } catch (error) {
        console.error('Erro ao carregar relatórios:', error);
        relatoriosGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--danger);"><i class="fas fa-exclamation-triangle" style="font-size: 50px; margin-bottom: 15px;"></i><p>Erro ao carregar relatórios: ' + error.message + '</p></div>';
    }
}

// Função para exibir relatórios na grid
function exibirRelatorios() {
    const relatoriosGrid = document.getElementById('relatorios-grid');
    relatoriosGrid.innerHTML = '';
    
    if (relatorios.length === 0) {
        relatoriosGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--gray);"><i class="fas fa-file-pdf" style="font-size: 50px; margin-bottom: 15px;"></i><p>Nenhum relatório encontrado. Faça upload do primeiro relatório.</p></div>';
    } else {
        relatorios.forEach(relatorio => {
            const relatorioCard = document.createElement('div');
            relatorioCard.className = 'relatorio-card';
            relatorioCard.innerHTML = `
                <div class="relatorio-capa">
                    <i class="fas fa-file-pdf relatorio-icon"></i>
                    <div class="relatorio-titulo-capa">${relatorio['Tipo de Relatorio'] || 'Relatório'}</div>
                </div>
                <div class="relatorio-nome">${relatorio.Nome}</div>
                <div class="relatorio-data">${formatarData(relatorio.DataUpload)}</div>
                <div class="relatorio-tipo">${relatorio['Tipo de Relatorio'] || 'Geral'}</div>
                <div class="relatorio-acoes">
                    <button class="relatorio-acao-btn view" onclick="visualizarRelatorio('${relatorio.ID}')">
                        <i class="fas fa-eye"></i> Ver
                    </button>
                    <button class="relatorio-acao-btn delete" onclick="eliminarRelatorio('${relatorio.ID}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            relatoriosGrid.appendChild(relatorioCard);
        });
    }
}

// Função para converter arquivo para base64
function fileToBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
            const base64 = reader.result.split(',')[1];
            resolve(base64);
        };
        reader.onerror = error => reject(error);
        reader.readAsDataURL(file);
    });
}

// Função para fazer upload do relatório
async function fazerUploadRelatorio() {
    const nome = document.getElementById('relatorio-nome').value.trim();
    const tipo = document.getElementById('relatorio-tipo').value;
    const fileInput = document.getElementById('relatorio-file');
    
    if (!nome || !tipo || !fileInput.files.length) {
        alert('Por favor, preencha todos os campos obrigatórios.');
        return;
    }
    
    const file = fileInput.files[0];
    
    if (file.type !== 'application/pdf') {
        alert('Por favor, selecione apenas arquivos PDF.');
        return;
    }
    
    if (file.size > 10 * 1024 * 1024) {
        alert('O arquivo é muito grande. O tamanho máximo é 10MB.');
        return;
    }
    
    const btnSalvar = document.getElementById('btn-salvar-relatorio');
    const originalText = btnSalvar.innerHTML;
    btnSalvar.innerHTML = '<div class="loading"></div> A carregar...';
    btnSalvar.disabled = true;
    
    try {
        const pdfData = await fileToBase64(file);
        
        const result = await callAppScriptRelatorios('uploadPDF', {
    nome: nome,
    tipoRelatorio: tipo,
    pdfData: pdfData
});
        
        if (result.success) {
            alert('Relatório carregado com sucesso!');
            fecharModalUploadRelatorio();
            carregarRelatorios();
        } else {
            throw new Error(result.message);
        }
    } catch (error) {
        console.error('Erro ao fazer upload:', error);
        alert('Erro ao fazer upload: ' + error.message);
    } finally {
        btnSalvar.innerHTML = originalText;
        btnSalvar.disabled = false;
    }
}

// Função para visualizar relatório
function visualizarRelatorio(id) {
    const relatorio = relatorios.find(r => r.ID === id);
    if (relatorio && relatorio.URL) {
        window.open(relatorio.URL, '_blank');
    } else {
        alert('URL do relatório não disponível.');
    }
}

// Função para eliminar relatório
async function eliminarRelatorio(id) {
    if (confirm('Tem certeza que deseja eliminar este relatório? Esta ação não pode ser desfeita.')) {
        try {
            const result = await callAppScriptRelatorios('deletePDF', { id: id });
            
            if (result.success) {
                alert('Relatório eliminado com sucesso!');
                carregarRelatorios();
            } else {
                throw new Error(result.message);
            }
        } catch (error) {
            console.error('Erro ao eliminar relatório:', error);
            alert('Erro ao eliminar relatório: ' + error.message);
        }
    }
}

// Função para fechar modal de upload
function fecharModalUploadRelatorio() {
    document.getElementById('modal-upload-relatorio').style.display = 'none';
    document.getElementById('form-upload-relatorio').reset();
    document.getElementById('file-info').style.display = 'none';
}

// Função para abrir modal de upload
function abrirModalUploadRelatorio() {
    document.getElementById('modal-upload-relatorio').style.display = 'flex';
    document.getElementById('relatorio-nome').focus();
}

// Função para lidar com upload de arquivos via drag and drop
function setupDragAndDrop() {
    const uploadArea = document.getElementById('upload-area');
    const fileInput = document.getElementById('file-input');
    const fileInfo = document.getElementById('file-info');
    
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    ['dragenter', 'dragover'].forEach(eventName => {
        uploadArea.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, unhighlight, false);
    });
    
    function highlight() {
        uploadArea.style.borderColor = 'var(--primary)';
        uploadArea.style.backgroundColor = '#f0f7ff';
    }
    
    function unhighlight() {
        uploadArea.style.borderColor = '#ddd';
        uploadArea.style.backgroundColor = '#f8f9fa';
    }
    
    uploadArea.addEventListener('drop', handleDrop, false);
    
    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        
        if (files.length > 0) {
            handleFiles(files);
        }
    }
    
    document.getElementById('btn-selecionar-arquivo').addEventListener('click', () => {
        fileInput.click();
    });
    
    fileInput.addEventListener('change', function() {
        if (this.files.length > 0) {
            handleFiles(this.files);
        }
    });
    
    function handleFiles(files) {
        const file = files[0];
        
        if (file.type !== 'application/pdf') {
            fileInfo.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Por favor, selecione apenas arquivos PDF.';
            fileInfo.className = 'file-info error';
            fileInfo.style.display = 'block';
            return;
        }
        
        if (file.size > 10 * 1024 * 1024) {
            fileInfo.innerHTML = '<i class="fas fa-exclamation-triangle"></i> O arquivo é muito grande. O tamanho máximo é 10MB.';
            fileInfo.className = 'file-info error';
            fileInfo.style.display = 'block';
            return;
        }
        
        const fileSize = (file.size / (1024 * 1024)).toFixed(2);
        fileInfo.innerHTML = `
            <i class="fas fa-check-circle"></i> 
            <strong>${file.name}</strong> (${fileSize} MB) - Pronto para upload.
            <br><small>Clique no botão "Upload de Relatório" para adicionar informações e salvar.</small>
        `;
        fileInfo.className = 'file-info';
        fileInfo.style.display = 'block';
        
        setTimeout(() => {
            abrirModalUploadRelatorio();
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(file);
            document.getElementById('relatorio-file').files = dataTransfer.files;
        }, 1000);
    }
}

        // Função para exportar a página de Resumo em PDF
        async function exportarResumoPDF() {
            try {
                const btnExportar = document.getElementById('btn-exportar-resumo');
                const originalText = btnExportar.innerHTML;
                btnExportar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Gerando PDF...';
                btnExportar.disabled = true;
                
                const { jsPDF } = window.jspdf;
                
                // Capturar todo o conteúdo da página de resumo
                const content = document.getElementById('resumo-content');
                
                // Usar html2canvas para capturar o conteúdo
                const canvas = await html2canvas(content, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    scrollY: -window.scrollY,
                    width: content.scrollWidth,
                    height: content.scrollHeight,
                    backgroundColor: '#f5f7fa'
                });
                
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 190;
                const pageHeight = 280;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                
                let heightLeft = imgHeight;
                let position = 10;
                
                // Adicionar título
                pdf.setFontSize(20);
                pdf.setTextColor(26, 78, 142);
                pdf.text('RELATÓRIO DE RESUMO - AGETRHA', 105, 15, { align: 'center' });
                
                pdf.setFontSize(12);
                pdf.setTextColor(100, 100, 100);
                pdf.text('Departamento de Pessoal e Quadros', 105, 22, { align: 'center' });
                
                // Data de geração
                const data = new Date().toLocaleDateString('pt-PT');
                pdf.text(`Gerado em: ${data}`, 105, 29, { align: 'center' });
                
                position = 40;
                
                // Adicionar a imagem do conteúdo
                pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                // Adicionar páginas adicionais se necessário
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight + 40;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                // Salvar o PDF
                pdf.save(`resumo-agetrha-${data.replace(/\//g, '-')}.pdf`);
                
                // Restaurar botão
                btnExportar.innerHTML = originalText;
                btnExportar.disabled = false;
                
            } catch (error) {
                console.error('Erro ao exportar PDF do resumo:', error);
                alert('Erro ao exportar o relatório. Tente novamente.');
                
                // Restaurar botão em caso de erro
                const btnExportar = document.getElementById('btn-exportar-resumo');
                if (btnExportar) {
                    btnExportar.innerHTML = '<i class="fas fa-download"></i> Exportar';
                    btnExportar.disabled = false;
                }
            }
        }

        // ===== JAVASCRIPT DOS PROJECTOS =====

        // URLs do Google Apps Script
        const GAS_WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbw3B3EVziPJVJr-4g1DxFWeHpIaXecl36iBxebJI4GrA-3L6-qM4LcAM2bkLKDr9n8W-w/exec';
        const MEMBERS_WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbwkAAbyTFC8wvyd3RozC6eXzu36VPbTvy9g02Sj4058eRl0SZZRlmRtjoQOscJ_fek1kA/exec';

        // Variáveis globais
        let projectos = [], projectosFiltrados = [], projectosPDF = [], statusChart, progressChart;
        let ultimoPDFSalvo = null;

        // ===== FUNÇÕES PRINCIPAIS DOS PROJECTOS =====

        // Formatar data
        function formatarDataProjectos(s) {
          if (!s) return '';
          const d = new Date(s);
          if (isNaN(d.getTime())) return s;
          return ('0'+d.getDate()).slice(-2) + '/' + ('0'+(d.getMonth()+1)).slice(-2) + '/' + d.getFullYear();
        }

        // Carregar projectos
        async function carregarProjectos() {
          try {
            const url = `${GAS_WEBAPP_URL}?action=getProjectos&t=${Date.now()}`;
            const controller = new AbortController();
            const timeout = setTimeout(() => controller.abort(), 15000);
            const resp = await fetch(url, { method: 'GET', signal: controller.signal, redirect:'follow' });
            clearTimeout(timeout);

            if (!resp.ok) throw new Error(`HTTP ${resp.status}`);

            const json = await resp.json();
            console.log('Dados recebidos dos projectos:', json);

            projectos = json.success ? (json.projectos || []) : [];
            
            aplicarFiltrosProjectos();
            carregarTabelaProjectos();
            atualizarEstatisticasProjectos();
            atualizarGraficosProjectos();

          } catch (err) {
            console.error('Erro carregarProjectos', err);
            projectos = [];
            aplicarFiltrosProjectos();
            carregarTabelaProjectos();
            atualizarEstatisticasProjectos();
            atualizarGraficosProjectos();
          }
        }

        // Carregar responsáveis
        async function carregarResponsaveis() {
          try {
            const url = `${MEMBERS_WEBAPP_URL}?action=getMembers&t=${Date.now()}`;
            const controller = new AbortController();
            const timeout = setTimeout(()=>controller.abort(),15000);
            const resp = await fetch(url, { method: 'GET', signal: controller.signal, redirect:'follow' });
            clearTimeout(timeout);
            if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
            const json = await resp.json();
            
            const select = document.getElementById('projecto-responsavel');
            while (select.children.length > 1) {
              select.removeChild(select.lastChild);
            }
            
            if (json.success && json.members) {
              const membrosOrdenados = json.members.sort((a, b) => {
                const nomeA = (a.nome || a['Nome Completo'] || '').toLowerCase();
                const nomeB = (b.nome || b['Nome Completo'] || '').toLowerCase();
                return nomeA.localeCompare(nomeB);
              });
              
              membrosOrdenados.forEach(membro => {
                const nomeCompleto = membro.nome || membro['Nome Completo'] || '';
                if (nomeCompleto) {
                  const option = document.createElement('option');
                  option.value = nomeCompleto;
                  option.textContent = nomeCompleto;
                  select.appendChild(option);
                }
              });
            }
          } catch (err) {
            console.error('Erro ao carregar responsáveis', err);
            const sel = document.getElementById('projecto-responsavel');
            if (sel.options.length <= 1) {
              ['Geraldina Francisco','João Silva','Maria Santos','Carlos Oliveira','Ana Pereira','Pedro Costa'].forEach(n=> {
                const op = document.createElement('option'); op.value=n; op.textContent=n; sel.appendChild(op);
              });
            }
          }
        }

        // Aplicar filtros
        function aplicarFiltrosProjectos() {
          const status = document.getElementById('filter-projecto-status').value;
          const respTerm = document.getElementById('filter-projecto-responsavel').value.trim().toLowerCase();
          projectosFiltrados = projectos.filter(p => {
            let ok = true;
            if (status) ok = ok && ((p.Status||p.status||'') === status);
            if (respTerm) ok = ok && (( (p.Responsavel||p.responsavel||p['Responsável']||'') + '' ).toLowerCase().includes(respTerm));
            return ok;
          });
        }

        // Atualizar estatísticas
        function atualizarEstatisticasProjectos() {
          const total = projectos.length;
          const execucao = projectos.filter(p=> (p.status||p.Status) === 'Em Execução').length;
          const concluidos = projectos.filter(p=> (p.status||p.Status) === 'Concluído').length;
          const suspensos = projectos.filter(p=> (p.status||p.Status) === 'Suspenso').length;
          let orc = 0;
          projectos.forEach(p => orc += parseFloat(p.Orcamento||p.orcamento||p['Orçamento']||0) || 0);
          document.getElementById('total-projectos').textContent = total;
          document.getElementById('projectos-execucao').textContent = execucao;
          document.getElementById('projectos-concluidos').textContent = concluidos;
          document.getElementById('projectos-suspensos').textContent = suspensos;
          document.getElementById('orcamento-total').textContent = orc.toLocaleString('pt-AO') + ' Kz';
        }

        // Inicializar gráficos
        function inicializarGraficosProjectos() {
          console.log('Inicializando gráficos dos projetos...');
          
          // Destruir gráficos existentes antes de criar novos
          if (typeof statusChart !== 'undefined' && statusChart) {
            statusChart.destroy();
          }
          if (typeof progressChart !== 'undefined' && progressChart) {
            progressChart.destroy();
          }

          const ctx1 = document.getElementById('statusChart');
          if (ctx1) {
            statusChart = new Chart(ctx1, { 
              type:'doughnut', 
              data:{ 
                labels:['Planeamento','Em Execução','Concluídos','Suspensos'], 
                datasets:[{
                  data:[0,0,0,0],
                  backgroundColor: ['#FFA500', '#87CEEB', '#28a745', '#8B0000']
                }]
              }, 
              options:{ 
                maintainAspectRatio: false,
                responsive: true,
                plugins: {
                  legend: {
                    position: 'bottom',
                    labels: {
                      boxWidth: 12,
                      font: { size: 11 },
                      padding: 15
                    }
                  }
                }
              } 
            });
          }
          
          const ctx2 = document.getElementById('progressChart');
          if (ctx2) {
            progressChart = new Chart(ctx2, { 
              type:'bar', 
              data:{ 
                labels:['Planeamento','Em Execução','Concluídos','Suspensos'], 
                datasets:[{ 
                  label:'Número de Projectos', 
                  data:[0,0,0,0],
                  backgroundColor: ['#FFA500', '#87CEEB', '#28a745', '#8B0000']
                }] 
              }, 
              options:{ 
                maintainAspectRatio: false,
                responsive: true,
                scales: {
                  y: {
                    beginAtZero: true,
                    ticks: { stepSize: 1 }
                  }
                }
              } 
            });
          }
        }

        // Atualizar gráficos
        function atualizarGraficosProjectos() {
          if (!statusChart) return;
          const plane = projectos.filter(p=> (p.status||p.Status) === 'Planeamento').length;
          const exec = projectos.filter(p=> (p.status||p.Status) === 'Em Execução').length;
          const conc = projectos.filter(p=> (p.status||p.Status) === 'Concluído').length;
          const susp = projectos.filter(p=> (p.status||p.Status) === 'Suspenso').length;
          statusChart.data.datasets[0].data = [plane, exec, conc, susp]; 
          statusChart.update();
          progressChart.data.datasets[0].data = [plane, exec, conc, susp]; 
          progressChart.update();
        }

        // Carregar tabela de projectos
        function carregarTabelaProjectos() {
          const tbody = document.getElementById('corpo-tabela-projectos');
          tbody.innerHTML = '';
          const lista = projectosFiltrados.length ? projectosFiltrados : projectos;
          
          if (!lista.length) {
            tbody.innerHTML = `<tr><td colspan="7" style="text-align:center;padding:40px;color:#6c757d">
              <i class="fas fa-project-diagram" style="font-size:40px;display:block"></i>
              Nenhum projecto encontrado<br>
              <button class="btn btn-primary" onclick="abrirModalProjecto()">Criar Primeiro Projecto</button>
            </td></tr>`;
            return;
          }
          
          lista.forEach(p => {
            const id = p.ID || p.Id || p.id || '';
            const nome = p['Nome do Projecto'] || p.Nome || p.nome || '';
            const resp = p.Responsavel || p.responsavel || p['Responsável'] || '';
            const di = formatarDataProjectos(p['Data Inicio'] || p.DataInicio || p.dataInicio || p['Data Início'] || '');
            const df = formatarDataProjectos(p['Data Fim'] || p.DataFim || p.dataFim || '');
            const status = p.Status || p.status || 'Planeamento';
            const orc = p.Orcamento || p.orcamento || p['Orçamento'] || '';
            
            let statusClass = '';
            switch(status) {
              case 'Planeamento': statusClass = 'status-planeamento'; break;
              case 'Em Execução': statusClass = 'status-execucao'; break;
              case 'Concluído': statusClass = 'status-concluido'; break;
              case 'Suspenso': statusClass = 'status-suspenso'; break;
            }
            
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td><strong>${nome}</strong></td>
              <td>${resp}</td>
              <td>${di}</td>
              <td>${df}</td>
              <td><span class="${statusClass}">${status}</span></td>
              <td>${orc ? parseFloat(orc).toLocaleString('pt-AO')+' Kz' : 'Não definido'}</td>
              <td>
                <button class="btn btn-small" onclick="verProjecto('${id}')"><i class="fas fa-eye"></i></button> 
                <button class="btn btn-small" onclick="editarProjecto('${id}')"><i class="fas fa-edit"></i></button> 
              </td>
            `;
            tbody.appendChild(tr);
          });
        }

        // Abrir modal de projecto
        function abrirModalProjecto(p=null) {
          const modal = document.getElementById('modal-projecto');
          document.getElementById('form-projecto').reset();
          
          if (p) {
            document.getElementById('modal-titulo-projecto').textContent = 'Editar Projecto';
            document.getElementById('projecto-id').value = p.ID || p.id || '';
            document.getElementById('projecto-nome').value = p['Nome do Projecto'] || p.Nome || p.nome || '';
            document.getElementById('projecto-data-inicio').value = (p['Data Inicio']||p.DataInicio||p.dataInicio||p['Data Início']||'').split('T')[0] || '';
            document.getElementById('projecto-data-fim').value = (p['Data Fim']||p.DataFim||p.dataFim||'').split('T')[0] || '';
            document.getElementById('projecto-responsavel').value = p.Responsavel || p.responsavel || p['Responsável'] || '';
            document.getElementById('projecto-descricao').value = p.Descricao || p.descricao || p['Descrição'] || '';
            document.getElementById('projecto-status').value = p.Status || p.status || 'Planeamento';
            document.getElementById('projecto-orcamento').value = p.Orcamento || p.orcamento || p['Orçamento'] || '';
          } else {
            document.getElementById('modal-titulo-projecto').textContent = 'Novo Projecto';
            document.getElementById('projecto-data-inicio').value = new Date().toISOString().split('T')[0];
          }
          
          carregarResponsaveis();
          modal.style.display = 'flex';
        }

        // Função para editar projecto
        function editarProjecto(id) {
          console.log('Editando projecto com ID:', id);
          
          // Encontrar o projecto na lista
          const projecto = projectos.find(p => String(p.Id) === String(id) || String(p.ID) === String(id) || String(p.id) === String(id));
          
          if (!projecto) {
            alert('Projecto não encontrado!');
            return;
          }
          
          // Abrir modal de edição
          abrirModalEditarProjecto(projecto);
        }

        // Abrir modal de edição
        function abrirModalEditarProjecto(p=null) {
          const modal = document.getElementById('modal-editar-projecto');
          document.getElementById('form-editar-projecto').reset();
          
          if (p) {
            document.getElementById('editar-projecto-id').value = p.Id || p.ID || p.id || '';
            document.getElementById('editar-projecto-status').value = p.Status || p.status || 'Planeamento';
            document.getElementById('editar-projecto-orcamento').value = p.Orcamento || p.orcamento || p['Orçamento'] || '';
          }
          
          modal.style.display = 'flex';
        }

        // Fechar modais
        function fecharModalProjectos() { 
          document.getElementById('modal-projecto').style.display = 'none'; 
          document.getElementById('modal-editar-projecto').style.display = 'none';
          document.getElementById('modal-upload-pdf').style.display = 'none';
          document.getElementById('modal-link-pdf').style.display = 'none';
          document.getElementById('modal-ver-projecto').style.display = 'none';
        }

        function fecharModalUploadPDF(){ 
          document.getElementById('modal-upload-pdf').style.display = 'none'; 
        }

        // Salvar projecto
        async function salvarProjecto() {
          const id = document.getElementById('projecto-id').value;
          const nome = document.getElementById('projecto-nome').value.trim();
          const dataInicio = document.getElementById('projecto-data-inicio').value;
          const dataFim = document.getElementById('projecto-data-fim').value;
          const responsavel = document.getElementById('projecto-responsavel').value;
          const descricao = document.getElementById('projecto-descricao').value.trim();
          const status = document.getElementById('projecto-status').value;
          const orcamento = document.getElementById('projecto-orcamento').value;
          
          if (!nome || !responsavel || !descricao || !dataInicio) { 
            alert('Preencha os campos obrigatórios'); 
            return; 
          }

          const btn = document.getElementById('btn-salvar-projecto');
          const orig = btn.innerHTML; 
          btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> A guardar...'; 
          btn.disabled = true;

          try {
            const params = new URLSearchParams();
            if (id) {
              params.append('action','updateProjecto');
              params.append('Id', id);
            } else {
              params.append('action','addProjecto');
            }
            params.append('Nome do Projecto', nome);
            params.append('Responsavel', responsavel);
            params.append('Data Inicio', dataInicio);
            params.append('Data Fim', dataFim);
            params.append('Descricao', descricao);
            params.append('Status', status);
            params.append('Orçamento', orcamento);

            const controller = new AbortController();
            const timeout = setTimeout(()=>controller.abort(),15000);
            const resp = await fetch(GAS_WEBAPP_URL, { 
              method:'POST', 
              headers:{ 'Content-Type':'application/x-www-form-urlencoded' }, 
              body: params.toString(), 
              signal: controller.signal, 
              redirect:'follow' 
            });
            clearTimeout(timeout);
            if (!resp.ok) throw new Error('HTTP ' + resp.status);
            const json = await resp.json();
            if (json.success) {
              await carregarProjectos();
              fecharModalProjectos();
              alert('Projecto salvo com sucesso');
            } else {
              alert('Erro: ' + (json.message || 'Erro desconhecido'));
            }
          } catch (err) {
            console.error('Erro salvarProjecto', err);
            alert('Erro ao salvar projecto.');
          } finally {
            btn.innerHTML = orig; 
            btn.disabled = false;
          }
        }

        // Salvar edição
        async function salvarEdicaoProjecto() {
          const id = document.getElementById('editar-projecto-id').value;
          const status = document.getElementById('editar-projecto-status').value;
          const orcamento = document.getElementById('editar-projecto-orcamento').value;
          
          if (!id) { 
            alert('ID do projecto não encontrado'); 
            return; 
          }

          const btn = document.getElementById('btn-salvar-editar-projecto');
          const orig = btn.innerHTML; 
          btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> A guardar...'; 
          btn.disabled = true;

          try {
            const params = new URLSearchParams();
            params.append('action', 'updateProjecto');
            params.append('Id', id);
            params.append('Status', status);
            params.append('Orçamento', orcamento);

            const controller = new AbortController();
            const timeout = setTimeout(() => controller.abort(), 15000);
            const resp = await fetch(GAS_WEBAPP_URL, { 
              method: 'POST', 
              headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, 
              body: params.toString(), 
              signal: controller.signal, 
              redirect: 'follow' 
            });
            clearTimeout(timeout);
            
            if (!resp.ok) throw new Error('HTTP ' + resp.status);
            
            const json = await resp.json();
            
            if (json.success) {
              await carregarProjectos();
              fecharModalProjectos();
              alert('Projecto actualizado com sucesso');
            } else {
              alert('Erro: ' + (json.message || 'Erro desconhecido'));
            }
          } catch (err) {
            console.error('Erro ao salvar edição do projecto:', err);
            alert('Erro ao actualizar projecto.');
          } finally {
            btn.innerHTML = orig; 
            btn.disabled = false;
          }
        }

        // Ver projecto - VERSÃO CORRIGIDA
        function verProjecto(id) {
            const p = projectos.find(x => String(x.Id) === String(id));
            
            if (!p) { 
                alert('Projecto não encontrado'); 
                return; 
            }
            
            const nome = p['Nome do Projecto'] || '';
            const resp = p.Responsavel || '';
            const di = formatarDataProjectos(p['Data Inicio'] || '');
            const df = formatarDataProjectos(p['Data Fim'] || '');
            const status = p.Status || 'Planeamento';
            const orc = p.Orcamento || '';
            const descricao = p.Descricao || '';
            
            const detalhes = document.getElementById('detalhes-projecto');
            detalhes.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label><strong>Nome do Projecto</strong></label>
                        <div>${nome}</div>
                    </div>
                    <div class="form-group">
                        <label><strong>Responsável</strong></label>
                        <div>${resp}</div>
                    </div>
                    <div class="form-group">
                        <label><strong>Data de Início</strong></label>
                        <div>${di}</div>
                    </div>
                    <div class="form-group">
                        <label><strong>Data de Fim</strong></label>
                        <div>${df}</div>
                    </div>
                    <div class="form-group">
                        <label><strong>Status</strong></label>
                        <div>${status}</div>
                    </div>
                    <div class="form-group">
                        <label><strong>Orçamento</strong></label>
                        <div>${orc ? parseFloat(orc).toLocaleString('pt-AO')+' Kz' : 'Não definido'}</div>
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label><strong>Descrição</strong></label>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; border: 1px solid #dee2e6;">${descricao}</div>
                    </div>
                </div>
            `;
            
            // ABRIR MODAL - VERSÃO CORRIGIDA
            const modal = document.getElementById('modal-ver-projecto');
            if (modal) {
                modal.style.display = 'flex';
                console.log('✅ Modal de ver projeto aberto');
                
                // Configurar os event listeners novamente (para garantir)
                configurarModalVerProjecto();
            } else {
                console.log('❌ Modal de ver projeto não encontrado');
            }
        }

        // ===== FUNÇÕES DE PDF =====

        // Carregar PDFs
        async function carregarPDFs() {
          try {
            const url = `${GAS_WEBAPP_URL}?action=getPDFs&t=${Date.now()}`;
            const controller = new AbortController(); 
            const timeout = setTimeout(()=>controller.abort(),15000);
            const resp = await fetch(url, { method:'GET', signal: controller.signal, redirect:'follow' });
            clearTimeout(timeout);
            if (!resp.ok) throw new Error('HTTP ' + resp.status);
            const json = await resp.json();
            
            projectosPDF = json.success ? (json.pdfs || []) : [];
            carregarGridPDFs();
          } catch (err) {
            console.error('Erro carregarPDFs', err);
            projectosPDF = [];
            carregarGridPDFs();
          }
        }

        // Carregar grid de PDFs
        function carregarGridPDFs() {
          const grid = document.getElementById('pdfs-grid'); 
          grid.innerHTML = '';
          
          if (!projectosPDF.length) {
            grid.innerHTML = `
              <div style="grid-column:1/-1;text-align:center;padding:40px;color:#6c757d">
                <i class="fas fa-file-pdf" style="font-size:50px"></i>
                <p>Nenhum PDF encontrado</p>
                <button class="btn btn-warning" onclick="abrirModalUploadPDF()">Fazer Upload do Primeiro PDF</button>
              </div>`;
            return;
          }
          
          projectosPDF.forEach(pdf=> {
            const nome = pdf.Nome || pdf.nome || '';
            const url = pdf.URL || pdf.url || '';
            const downloadUrl = pdf.downloadUrl || url;
            const id = pdf.ID || pdf.id || '';
            
            const card = document.createElement('div');
            card.className = 'pdf-card';
            card.innerHTML = `
              <div class="pdf-icon"><i class="fas fa-file-pdf"></i></div>
              <div class="pdf-name">${nome}</div>
              <div class="pdf-date">Upload: ${formatarDataProjectos(pdf.DataUpload||pdf.dataUpload||pdf.data||pdf['Data Upload']||'')}</div>
              <div class="pdf-actions">
                <button class="btn btn-primary btn-small" onclick="window.open('${url}','_blank')"><i class="fas fa-eye"></i> Ver</button>
                <button class="btn btn-success btn-small" onclick="window.open('${downloadUrl}','_blank')"><i class="fas fa-download"></i> Download</button>
                <button class="btn btn-danger btn-small" onclick="deletarPDF('${id}')"><i class="fas fa-trash"></i> Deletar</button>
              </div>
            `;
            grid.appendChild(card);
          });
        }

        // Abrir modal de upload de PDF
        function abrirModalUploadPDF() { 
          document.getElementById('modal-upload-pdf').style.display='flex'; 
          document.getElementById('form-upload-pdf').reset(); 
        }

        // Convert file to base64
        function fileToBase64(file) {
          return new Promise((resolve,reject)=>{
            const reader = new FileReader();
            reader.onload = ()=>{ 
              const res = reader.result; 
              const idx = res.indexOf(','); 
              resolve(idx>=0?res.slice(idx+1):res); 
            };
            reader.onerror = e => reject(e);
            reader.readAsDataURL(file);
          });
        }

        // Salvar PDF
        async function salvarPDF() {
          const nome = document.getElementById('pdf-nome').value.trim();
          const file = document.getElementById('pdf-file').files[0];
          
          if (!nome || !file) { 
            alert('Preencha os campos'); 
            return; 
          }
          
          if (file.size > 10*1024*1024) { 
            alert('Máx 10MB'); 
            return; 
          }
          
          const btn = document.getElementById('btn-salvar-pdf'); 
          const orig = btn.innerHTML; 
          btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> A carregar...'; 
          btn.disabled = true;
          
          try {
            const base64 = await fileToBase64(file);
            const params = new URLSearchParams();
            params.append('action','uploadPDF'); 
            params.append('nome', nome); 
            params.append('pdfData', base64);
            
            const controller = new AbortController(); 
            const timeout = setTimeout(()=>controller.abort(),30000);
            const resp = await fetch(GAS_WEBAPP_URL, { 
              method:'POST', 
              headers:{ 'Content-Type':'application/x-www-form-urlencoded' }, 
              body: params.toString(), 
              signal: controller.signal, 
              redirect:'follow' 
            });
            clearTimeout(timeout);
            if (!resp.ok) throw new Error('HTTP ' + resp.status);
            const json = await resp.json();
            
            if (json.success) { 
          fecharModalUploadPDF(); 
          await carregarPDFs(); 
          
          const pdfUrl = json.url || json.fileUrl || json.downloadUrl || json.link;
          if (pdfUrl) {
            ultimoPDFSalvo = pdfUrl;
            
            // Mostrar modal de sucesso
            document.getElementById('modal-link-pdf').style.display = 'flex';
            
            // Fechar automaticamente após 3 segundos
            setTimeout(() => {
              document.getElementById('modal-link-pdf').style.display = 'none';
            }, 3000);
          }
        } else {
              alert('Erro: '+(json.message||''));
            }
          } catch (err) { 
            console.error('Erro salvarPDF', err); 
            alert('Erro ao carregar PDF.'); 
          } finally { 
            btn.innerHTML = orig; 
            btn.disabled = false; 
          }
        }

        // Deletar PDF
        async function deletarPDF(id) {
          if (!confirm("Tem certeza que deseja eliminar este PDF?")) return;

          try {
            const params = new URLSearchParams();
            params.append("action", "deletePDF");
            params.append("id", id);

            const resp = await fetch(GAS_WEBAPP_URL, {
              method: "POST",
              headers: { "Content-Type": "application/x-www-form-urlencoded" },
              body: params.toString()
            });

            const json = await resp.json();

            if (json.success) {
              alert("PDF eliminado com sucesso!");
              carregarPDFs();
            } else {
              alert("Erro: " + (json.message || "Não foi possível eliminar o PDF."));
            }

          } catch (err) {
            console.error("Erro ao eliminar PDF:", err);
            alert("Erro inesperado ao eliminar PDF.");
          }
        }

        // ===== FUNÇÃO PARA GERAR RELATÓRIO PDF DOS PROJECTOS =====
        async function gerarRelatorioPDF() {
            try {
                const btnRelatorio = document.getElementById('btn-gerar-relatorio');
                const originalText = btnRelatorio.innerHTML;
                btnRelatorio.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Gerando PDF...';
                btnRelatorio.disabled = true;
                
                const { jsPDF } = window.jspdf;
                
                // Capturar a seção de projetos
                const content = document.getElementById('projectos-inner-content');
                
                // Usar html2canvas para capturar o conteúdo
                const canvas = await html2canvas(content, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    scrollY: -window.scrollY,
                    width: content.scrollWidth,
                    height: content.scrollHeight,
                    backgroundColor: '#f5f7fa'
                });
                
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 190;
                const pageHeight = 280;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                
                let heightLeft = imgHeight;
                let position = 10;
                
                // Adicionar título
                pdf.setFontSize(20);
                pdf.setTextColor(26, 78, 142);
                pdf.text('RELATÓRIO DE PROJECTOS - AGETRHA', 105, 15, { align: 'center' });
                
                pdf.setFontSize(12);
                pdf.setTextColor(100, 100, 100);
                pdf.text('Departamento de Pessoal e Quadros', 105, 22, { align: 'center' });
                
                // Data de geração
                const data = new Date().toLocaleDateString('pt-PT');
                pdf.text(`Gerado em: ${data}`, 105, 29, { align: 'center' });
                
                position = 40;
                
                // Adicionar a imagem do conteúdo
                pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                // Adicionar páginas adicionais se necessário
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight + 40;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                // Salvar o PDF
                pdf.save(`relatorio-projectos-${data.replace(/\//g, '-')}.pdf`);
                
                // Restaurar botão
                btnRelatorio.innerHTML = originalText;
                btnRelatorio.disabled = false;
                
            } catch (error) {
                console.error('Erro ao gerar relatório de projetos:', error);
                alert('Erro ao gerar o relatório. Tente novamente.');
                
                // Restaurar botão em caso de erro
                const btnRelatorio = document.getElementById('btn-gerar-relatorio');
                if (btnRelatorio) {
                    btnRelatorio.innerHTML = '<i class="fas fa-file-pdf"></i> Gerar Relatório';
                    btnRelatorio.disabled = false;
                }
            }
        }

        // ===== FUNÇÕES DE INTEGRAÇÃO =====

        // ===== CORREÇÃO DO MODAL DE VER DETALHES DO PROJETO =====
        function configurarModalVerProjecto() {
            console.log('🔧 Configurando modal de ver projeto...');
            
            // Botão X (canto superior direito)
            const btnFecharX = document.getElementById('btn-fechar-modal-ver-projecto');
            // Botão Fechar (rodapé)
            const btnFecharFooter = document.getElementById('btn-fechar-ver-projecto');
            
            if (btnFecharX) {
                console.log('✅ Botão X encontrado');
                btnFecharX.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('📌 Clicou no X do modal de ver projeto');
                    fecharModalVerProjecto();
                });
            } else {
                console.log('❌ Botão X não encontrado');
            }
            
            if (btnFecharFooter) {
                console.log('✅ Botão Fechar encontrado');
                btnFecharFooter.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('📌 Clicou no botão Fechar do modal de ver projeto');
                    fecharModalVerProjecto();
                });
            } else {
                console.log('❌ Botão Fechar não encontrado');
            }
            
            // Fechar modal clicando fora do conteúdo
            const modal = document.getElementById('modal-ver-projecto');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        console.log('📌 Clicou fora do modal de ver projeto');
                        fecharModalVerProjecto();
                    }
                });
            }
        }

        // Função específica para fechar apenas este modal
        function fecharModalVerProjecto() {
            console.log('🚪 Fechando modal de ver projeto...');
            const modal = document.getElementById('modal-ver-projecto');
            if (modal) {
                modal.style.display = 'none';
                console.log('✅ Modal de ver projeto fechado');
            } else {
                console.log('❌ Modal de ver projeto não encontrado para fechar');
            }
        }

        // Voltar ao dashboard
        function voltarParaDashboard() {
          document.getElementById('projectos-content').style.display = 'none';
          document.getElementById('resumo-content').style.display = 'block';
          
          document.querySelectorAll('.sidebar-menu a').forEach(item => {
            item.classList.remove('active');
          });
          document.querySelector('[data-page="resumo"]').classList.add('active');
        }

        // Alternar entre projetos e PDFs
        function mostrarProjectos() {
          document.getElementById('projectos-inner-content').style.display = 'block';
          document.getElementById('pdfs-content').style.display = 'none';
        }

        function mostrarPDFs() {
          document.getElementById('projectos-inner-content').style.display = 'none';
          document.getElementById('pdfs-content').style.display = 'block';
          carregarPDFs();
        }

        // Configurar event listeners
        function configurarEventListenersProjetos() {
          console.log('Configurando event listeners dos projetos...');
          
          // Botões principais
          const btnVoltar = document.getElementById('btn-voltar-dashboard');
          const btnNovoProjecto = document.getElementById('btn-novo-projecto');
          const btnVerPDFs = document.getElementById('btn-ver-pdfs');
          const btnVoltarProjectos = document.getElementById('btn-voltar-projectos');
          const btnFiltros = document.getElementById('btn-aplicar-filtros-projectos');
          const btnRelatorio = document.getElementById('btn-gerar-relatorio');
          
          if (btnVoltar) btnVoltar.addEventListener('click', voltarParaDashboard);
          if (btnNovoProjecto) btnNovoProjecto.addEventListener('click', () => abrirModalProjecto());
          if (btnVerPDFs) btnVerPDFs.addEventListener('click', mostrarPDFs);
          if (btnVoltarProjectos) btnVoltarProjectos.addEventListener('click', mostrarProjectos);
          if (btnFiltros) btnFiltros.addEventListener('click', () => { 
            aplicarFiltrosProjectos(); 
            carregarTabelaProjectos(); 
          });
          if (btnRelatorio) btnRelatorio.addEventListener('click', gerarRelatorioPDF);
        }

        function configurarModaisProjetos() {
          console.log('Configurando modais dos projetos...');
          
          // Modal Projecto
          const btnFecharProjecto = document.getElementById('btn-fechar-modal-projecto');
          const btnCancelarProjecto = document.getElementById('btn-cancelar-projecto');
          const btnSalvarProjecto = document.getElementById('btn-salvar-projecto');
          
          if (btnFecharProjecto) btnFecharProjecto.addEventListener('click', fecharModalProjectos);
          if (btnCancelarProjecto) btnCancelarProjecto.addEventListener('click', fecharModalProjectos);
          if (btnSalvarProjecto) btnSalvarProjecto.addEventListener('click', salvarProjecto);
          
          // Modal Editar Projecto - ESTA PARTE É CRÍTICA
          const btnFecharEditar = document.getElementById('btn-fechar-modal-editar-projecto');
          const btnCancelarEditar = document.getElementById('btn-cancelar-editar-projecto');
          const btnSalvarEditar = document.getElementById('btn-salvar-editar-projecto');
          
          if (btnFecharEditar) btnFecharEditar.addEventListener('click', fecharModalProjectos);
          if (btnCancelarEditar) btnCancelarEditar.addEventListener('click', fecharModalProjectos);
          if (btnSalvarEditar) btnSalvarEditar.addEventListener('click', salvarEdicaoProjecto);
          
          // Modal Upload PDF
          const btnUploadPDF = document.getElementById('btn-upload-pdf');
          const btnFecharUpload = document.getElementById('btn-fechar-modal-upload-pdf');
          const btnCancelarUpload = document.getElementById('btn-cancelar-upload-pdf');
          const btnSalvarPDF = document.getElementById('btn-salvar-pdf');
          
          if (btnUploadPDF) btnUploadPDF.addEventListener('click', abrirModalUploadPDF);
          if (btnFecharUpload) btnFecharUpload.addEventListener('click', fecharModalUploadPDF);
          if (btnCancelarUpload) btnCancelarUpload.addEventListener('click', fecharModalUploadPDF);
          if (btnSalvarPDF) btnSalvarPDF.addEventListener('click', salvarPDF);
        }

        // Inicialização da página de projetos - ATUALIZADA
        function inicializarPaginaProjetos() {
            console.log('🚀 INICIALIZANDO PÁGINA DE PROJECTOS...');
            
            configurarEventListenersProjetos();
            configurarModaisProjetos();
            configurarModalVerProjecto(); // ← ADICIONAR ESTA LINHA
            inicializarGraficosProjectos();
            carregarProjectos();
            carregarResponsaveis();
            
            console.log('✅ Página de projetos inicializada!');
        }

        // ===== INTEGRAÇÃO FINAL =====

        // Configuração simples para fechar modal de sucesso PDF
        document.addEventListener('click', function(e) {
          const modal = document.getElementById('modal-link-pdf');
          if (modal && modal.style.display === 'flex' && e.target === modal) {
            modal.style.display = 'none';
          }
        });

// ===== FUNÇÕES DAS CONFIGURAÇÕES =====

// Função para abrir modal de configurações
function abrirModalConfiguracoes() {
    // Carregar configurações salvas
    carregarConfiguracoesSalvas();
    
    document.getElementById('modal-configuracoes').style.display = 'flex';
}

// Função para fechar modal de configurações
function fecharModalConfiguracoes() {
    document.getElementById('modal-configuracoes').style.display = 'none';
}

// Função para aplicar configurações
function aplicarConfiguracoes() {
    const temaSelecionado = document.querySelector('.color-option.active')?.dataset.theme || 'default';
    const idiomaSelecionado = document.querySelector('.language-btn.active')?.dataset.lang || 'pt';
    const darkMode = document.getElementById('toggle-dark-mode').checked;
    const sidebarCompacta = document.getElementById('toggle-sidebar-compact').checked;

    // Aplicar tema
    document.documentElement.setAttribute('data-theme', temaSelecionado);
    
    // Aplicar modo escuro
    if (darkMode) {
        document.body.classList.add('dark-mode');
    } else {
        document.body.classList.remove('dark-mode');
    }
    
    // Aplicar sidebar compacta
    if (sidebarCompacta) {
        document.querySelector('.sidebar').classList.add('compact');
    } else {
        document.querySelector('.sidebar').classList.remove('compact');
    }
    
    // Aplicar idioma (implementação básica)
    aplicarIdioma(idiomaSelecionado);

    // Salvar configurações
    salvarConfiguracoes({
        tema: temaSelecionado,
        idioma: idiomaSelecionado,
        darkMode: darkMode,
        sidebarCompacta: sidebarCompacta
    });

    alert('Configurações aplicadas com sucesso!');
    fecharModalConfiguracoes();
}

// Função para aplicar idioma
function aplicarIdioma(idioma) {
    const traducoes = {
    'pt': {
        'resumo': 'Resumo',
        'gestao-membros': 'Gestão de Membros',
        'organograma': 'Organograma',
	'candidaturas': 'Candidaturas',
        'projectos': 'Projectos',
        'relatorios': 'Relatórios',
        'configuracoes': 'Configurações',
        'total-membros': 'TOTAL DE MEMBROS',
        'membros-regulares': 'MEMBROS REGULARES',
        'inadimplentes': 'INADIMPLENTES',
        'total-candidaturas': 'TOTAL DE CANDIDATURAS',
        'membros-recentes': 'Membros Recentes',
        'todos-membros': 'Todos os Membros',
        'membros-regulares-tab': 'Membros Regulares',
        'membros-suspensos': 'Membros Suspensos',
        'membros-pendentes': 'Membros Pendentes',
        'membros-divida': 'Membros em Dívida',
	'dep-pessoal-quadros': 'DEP. PESSOAL E QUADROS - AGETRHA',
        'presidente': 'Presidente',
        'novo-membro': 'Novo Membro',
        'exportar': 'Exportar',
        'filtrar': 'Filtrar',
        'aplicar-filtros': 'Aplicar Filtros',
        'ver-todos': 'Ver Todos',
        'adicionar': 'Adicionar',
        'editar': 'Editar',
        'eliminar': 'Eliminar',
        'salvar': 'Salvar',
        'cancelar': 'Cancelar',
	'evolucao-mensal': 'Evolução Mensal de Novos Membros',
        'distribuicao-categoria': 'Distribuição de Membros por Categoria',
        'todos-membros': 'Todos os Membros',
        'membros-regulares-tab': 'Membros Regulares',
        'membros-suspensos': 'Membros Suspensos',
        'membros-pendentes': 'Membros Pendentes',
        'membros-divida': 'Membros em Dívida',
	'categoria': 'Categoria',
        'todas-categorias': 'Todas as categorias',
	'status': 'Status',
        'todos-status': 'Todos os status',
        'regular': 'Regular',
        'suspenso': 'Suspenso', 
        'pendente': 'Pendente',
        'divida': 'Dívida',
        'nome-membro': 'Nome do Membro',
        'digite-nome': 'Digite o nome...',
	'nome': 'Nome',
        'data-admissao': 'Data Admissão',
        'numero-membro': 'Número de Membro',
        'acoes': 'Ações'
		
    },

    'en': {
        'resumo': 'Dashboard',
        'gestao-membros': 'Members Management',
        'organograma': 'Organization Chart',
	'candidaturas': 'Applications',
	'projectos': 'Projects',
        'relatorios': 'Reports',
        'configuracoes': 'Settings',
        'total-membros': 'TOTAL MEMBERS',
        'membros-regulares': 'REGULAR MEMBERS',
        'inadimplentes': 'OVERDUE MEMBERS',
        'total-candidaturas': 'TOTAL APPLICATIONS',
        'membros-recentes': 'Recent Members',
        'todos-membros': 'All Members',
        'membros-regulares-tab': 'Regular Members',
        'membros-suspensos': 'Suspended Members',
        'membros-pendentes': 'Pending Members',
        'membros-divida': 'Members in Debt',
	'dep-pessoal-quadros': 'PERSONNEL DEPT. - AGETRHA',
        'presidente': 'President',
        'novo-membro': 'New Member',
        'exportar': 'Export',
        'filtrar': 'Filter',
        'aplicar-filtros': 'Apply Filters',
        'ver-todos': 'View All',
        'adicionar': 'Add',
        'editar': 'Edit',
        'eliminar': 'Delete',
        'salvar': 'Save',
        'cancelar': 'Cancel',
	'evolucao-mensal': 'Monthly New Members Evolution',
        'distribuicao-categoria': 'Members Distribution by Category',
        'todos-membros': 'All Members',
        'membros-regulares-tab': 'Regular Members',
        'membros-suspensos': 'Suspended Members',
        'membros-pendentes': 'Pending Members',
        'membros-divida': 'Members in Debt',
	'categoria': 'Category',
        'todas-categorias': 'All categories',
	'status': 'Status',
        'todos-status': 'All status',
        'regular': 'Regular',
        'suspenso': 'Suspended',
        'pendente': 'Pending',
        'divida': 'Debt',
        'nome-membro': 'Member Name',
        'digite-nome': 'Type the name...',
	'nome': 'Name',
        'data-admissao': 'Admission Date',
        'numero-membro': 'Member Number', 
        'acoes': 'Actions'
	
    }
};

    // Aplicar traduções aos elementos com data-i18n
    Object.keys(traducoes[idioma]).forEach(key => {
        const elementos = document.querySelectorAll(`[data-i18n="${key}"]`);
        elementos.forEach(el => {
            el.textContent = traducoes[idioma][key];
        });
        
        // Traduzir placeholders com data-i18n-placeholder
        const elementosPlaceholder = document.querySelectorAll(`[data-i18n-placeholder="${key}"]`);
        elementosPlaceholder.forEach(el => {
            el.placeholder = traducoes[idioma][key];
        });
    });
    
    console.log(`✅ Idioma aplicado: ${idioma}`);
}


// Função para salvar configurações
function salvarConfiguracoes(config) {
    localStorage.setItem('dashboard-configuracoes', JSON.stringify(config));
}

// Função para carregar configurações salvas
function carregarConfiguracoesSalvas() {
    const configSalvas = JSON.parse(localStorage.getItem('dashboard-configuracoes')) || {};
    
    // Aplicar configurações salvas aos controles
    if (configSalvas.tema) {
        const colorOption = document.querySelector(`[data-theme="${configSalvas.tema}"]`);
        document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('active'));
        if (colorOption) colorOption.classList.add('active');
    }
    
    if (configSalvas.idioma) {
        document.querySelectorAll('.language-btn').forEach(btn => btn.classList.remove('active'));
        const langBtn = document.querySelector(`[data-lang="${configSalvas.idioma}"]`);
        if (langBtn) langBtn.classList.add('active');
    }
    
    if (configSalvas.darkMode !== undefined) {
        document.getElementById('toggle-dark-mode').checked = configSalvas.darkMode;
    }
    
    if (configSalvas.sidebarCompacta !== undefined) {
        document.getElementById('toggle-sidebar-compact').checked = configSalvas.sidebarCompacta;
    }
}

// Função para carregar configurações na inicialização
function carregarConfiguracoesIniciais() {
    const configSalvas = JSON.parse(localStorage.getItem('dashboard-configuracoes')) || {};
    
    if (configSalvas.tema) {
        document.documentElement.setAttribute('data-theme', configSalvas.tema);
    }
    
    if (configSalvas.darkMode) {
        document.body.classList.add('dark-mode');
    }
    
    if (configSalvas.sidebarCompacta) {
        document.querySelector('.sidebar').classList.add('compact');
    }
    
    if (configSalvas.idioma) {
        aplicarIdioma(configSalvas.idioma);
    }
}

// Função para redefinir configurações
function redefinirConfiguracoes() {
    localStorage.removeItem('dashboard-configuracoes');
    document.documentElement.removeAttribute('data-theme');
    document.body.classList.remove('dark-mode');
    document.querySelector('.sidebar').classList.remove('compact');
    aplicarIdioma('pt');
    
    // Recarregar modal para mostrar estado padrão
    carregarConfiguracoesSalvas();
    
    alert('Configurações redefinidas para o padrão!');
}

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Carregar foto da presidente
            loadPresidentPhoto();
            
            // Configurar event listeners
            document.getElementById('btn-novo-membro').addEventListener('click', () => {
                window.open('https://agetrha-dpq.github.io/Formulario-agetrha/', '_blank');
            });
            
            document.getElementById('btn-fechar-modal').addEventListener('click', fecharModal);
            document.getElementById('btn-cancelar').addEventListener('click', fecharModal);
            document.getElementById('btn-salvar-membro').addEventListener('click', salvarMembro);
            document.getElementById('btn-pagou').addEventListener('click', marcarPagamento);
            document.getElementById('btn-fechar-modal-ver').addEventListener('click', fecharModal);
            document.getElementById('btn-fechar-ver').addEventListener('click', fecharModal);
            
	    configurarAutocompleteNome();

            // Event listener para status
            document.getElementById('status').addEventListener('change', function() {
                const status = this.value;
                if (status === 'Dívida') {
                    document.getElementById('btn-em-divida').style.display = 'inline-block';
                    document.getElementById('info-pagamento').innerHTML = '<i class="fas fa-exclamation-triangle" style="color: var(--danger);"></i> Este membro está em dívida';
                } else {
                    document.getElementById('btn-em-divida').style.display = 'none';
                    document.getElementById('info-pagamento').innerHTML = '<i class="fas fa-check" style="color: var(--success);"></i> Pagamento em dia';
                }
            });
            
            // Configurar filtros
            document.getElementById('btn-aplicar-filtros').addEventListener('click', function() {
                currentFilters.categoria = document.getElementById('filter-categoria').value;
                currentFilters.status = document.getElementById('filter-status').value;
                currentFilters.nome = document.getElementById('filter-nome').value;
                carregarTabelaMembros();
            });
            
            // Configurar tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const tabName = this.getAttribute('data-tab');
                    let status = '';
                    
                    if (tabName === 'regulares') status = 'Regular';
                    else if (tabName === 'suspensos') status = 'Suspenso';
                    else if (tabName === 'pendentes') status = 'Pendente';
                    else if (tabName === 'divida') status = 'Dívida';
                    
                    currentFilters.status = status;
                    document.getElementById('filter-status').value = status;
                    carregarTabelaMembros();
                });
            });
            
            // Configurar navegação
            document.querySelectorAll('.sidebar-menu a').forEach(item => {
                item.addEventListener('click', function(e) {
                    if (!this.getAttribute('href').startsWith('http')) {
                        e.preventDefault();
                        const pagina = this.getAttribute('data-page');
                        if (pagina) alternarPagina(pagina);
                    }
                });
            });
            
            // ======= EVENT LISTENERS DO ORGANOGRAMA - REMOVIDOS TEMPORARIAMENTE =======
// Todos os event listeners do organograma foram removidos temporariamente
// pois a página está em desenvolvimento
            
            // Event listeners para modal de novo cargo - REMOVIDOS TEMPORARIAMENTE
// pois a página está em desenvolvimento

            
            // Atualizar pré-visualização da foto quando o ID mudar
            document.getElementById('foto-id').addEventListener('input', function() {
                atualizarPreviewFoto();
            });
            
            /*
// Auto-completar nome do membro - COMENTADO TEMPORARIAMENTE
document.getElementById('nome-cargo').addEventListener('input', function() {
    const nome = this.value;
    const membro = membros.find(m => m.nome === nome);
    
    if (membro) {
        document.getElementById('numero-membro-cargo').value = membro.numeroMembro;
    } else {
        document.getElementById('numero-membro-cargo').value = '';
    }
});
*/
            
    // ===== CONFIGURAÇÕES - EVENT LISTENERS =====
    
    // Configurações - Event Listener para o menu
    document.querySelector('[data-page="configuracoes"]').addEventListener('click', function(e) {
        e.preventDefault();
        abrirModalConfiguracoes();
    });

    // Event listeners do modal de configurações
    document.getElementById('btn-fechar-modal-configuracoes').addEventListener('click', fecharModalConfiguracoes);
    document.getElementById('btn-aplicar-configuracoes').addEventListener('click', aplicarConfiguracoes);
    document.getElementById('btn-redefinir-configuracoes').addEventListener('click', redefinirConfiguracoes);

    // Event listeners para seleção de cores
    document.querySelectorAll('.color-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('active'));
            this.classList.add('active');
        });
    });

    // Event listeners para seleção de idioma
    document.querySelectorAll('.language-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.language-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
        });
    });

    // Carregar configurações iniciais
    carregarConfiguracoesIniciais();

            // ======= EVENT LISTENERS DOS RELATÓRIOS =======
                // Configurar event listeners dos relatórios
    document.getElementById('btn-upload-relatorio').addEventListener('click', abrirModalUploadRelatorio);
    document.getElementById('btn-fechar-modal-upload').addEventListener('click', fecharModalUploadRelatorio);
    document.getElementById('btn-cancelar-upload').addEventListener('click', fecharModalUploadRelatorio);
    document.getElementById('btn-salvar-relatorio').addEventListener('click', fazerUploadRelatorio);
    
    // Configurar drag and drop para upload de relatórios
    setupDragAndDrop();
            
// Adicionar event listener para o botão de upload (placeholder)
// Event listener para o botão de upload de foto
const btnUploadFoto = document.getElementById('btn-upload-foto');
if (btnUploadFoto) {
    btnUploadFoto.addEventListener('click', uploadFotoOrganograma);
}

// Event listener para preview local quando selecionar arquivo
const fotoUpload = document.getElementById('foto-upload');
if (fotoUpload) {
    fotoUpload.addEventListener('change', function() {
        if (this.files && this.files[0]) {
            // Pré-visualização local temporária
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('photo-preview').src = e.target.result;
            };
            reader.readAsDataURL(this.files[0]);
        }
    });
}

// Configurar autocomplete do nome
configurarAutocompleteNome();

            // Inicializar gráficos
            inicializarGraficos();
            
            // Iniciar sincronização
            sincronizarComSheets();

            // Chamar a correção após o carregamento
            setTimeout(corrigirCarregamentoFotos, 1000);

            // Garantir que a página inicial seja o Resumo
            alternarPagina('resumo');
        });

        console.log('✅ JAVASCRIPT DOS PROJECTOS CARREGADO!');
    // Adicione esta função para atualizar dinamicamente as cores


// Modifique a função aplicarConfiguracoes para chamar esta atualização
function aplicarConfiguracoes() {
    const temaSelecionado = document.querySelector('.color-option.active')?.dataset.theme || 'default';
    const idiomaSelecionado = document.querySelector('.language-btn.active')?.dataset.lang || 'pt';
    const darkMode = document.getElementById('toggle-dark-mode').checked;
    const sidebarCompacta = document.getElementById('toggle-sidebar-compact').checked;

    // Aplicar tema
    document.documentElement.setAttribute('data-theme', temaSelecionado);
    
    // Aplicar modo escuro
    if (darkMode) {
        document.body.classList.add('dark-mode');
    } else {
        document.body.classList.remove('dark-mode');
    }
    
    // Aplicar sidebar compacta
    if (sidebarCompacta) {
        document.querySelector('.sidebar').classList.add('compact');
    } else {
        document.querySelector('.sidebar').classList.remove('compact');
    }
    
    // Aplicar idioma
    aplicarIdioma(idiomaSelecionado);

    
    // Salvar configurações
    salvarConfiguracoes({
        tema: temaSelecionado,
        idioma: idiomaSelecionado,
        darkMode: darkMode,
        sidebarCompacta: sidebarCompacta
    });

    alert('Configurações aplicadas com sucesso!');
    fecharModalConfiguracoes();
}
</script>

<!-- Modal de Configurações -->
<div id="modal-configuracoes" class="modal">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h2><i class="fas fa-cogs"></i> Configurações</h2>
            <button id="btn-fechar-modal-configuracoes" style="background: none; border: none; font-size: 20px; cursor: pointer;">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <h3 style="color: var(--primary); margin-bottom: 15px;"><i class="fas fa-palette"></i> Personalização de Cores</h3>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
                    <div class="color-option" data-theme="default">
                        <div class="color-preview" style="background: linear-gradient(135deg, #1a4e8e 0%, #2a6cba 100%);"></div>
                        <span>Azul Original</span>
                    </div>
                    <div class="color-option" data-theme="green">
                        <div class="color-preview" style="background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);"></div>
                        <span>Verde</span>
                    </div>
                    <div class="color-option" data-theme="purple">
                        <div class="color-preview" style="background: linear-gradient(135deg, #6a1b9a 0%, #9c27b0 100%);"></div>
                        <span>Roxo</span>
                    </div>
                    <div class="color-option" data-theme="orange">
                        <div class="color-preview" style="background: linear-gradient(135deg, #e65100 0%, #ff9800 100%);"></div>
                        <span>Laranja</span>
                    </div>
                    <div class="color-option" data-theme="red">
                        <div class="color-preview" style="background: linear-gradient(135deg, #c62828 0%, #f44336 100%);"></div>
                        <span>Vermelho</span>
                    </div>
                    <div class="color-option" data-theme="dark">
                        <div class="color-preview" style="background: linear-gradient(135deg, #263238 0%, #455a64 100%);"></div>
                        <span>Escuro</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <h3 style="color: var(--primary); margin-bottom: 15px;"><i class="fas fa-language"></i> Idioma / Language</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button class="btn btn-outline language-btn active" data-lang="pt">
                        <i class="fas fa-flag"></i> Português
                    </button>
                    <button class="btn btn-outline language-btn" data-lang="en">
                        <i class="fas fa-flag-usa"></i> English
                    </button>
                </div>
            </div>

            <div class="form-group">
                <h3 style="color: var(--primary); margin-bottom: 15px;"><i class="fas fa-brush"></i> Outras Opções</h3>
                
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="toggle-dark-mode" class="form-control" style="width: auto;">
                        <span>Modo Escuro</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="toggle-sidebar-compact" class="form-control" style="width: auto;">
                        <span>Sidebar Compacta</span>
                    </label>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" id="btn-aplicar-configuracoes">
                <i class="fas fa-check"></i> Aplicar Configurações
            </button>
            <button class="btn" id="btn-redefinir-configuracoes">
                <i class="fas fa-undo"></i> Redefinir
            </button>
        </div>
    </div>
</div>

<datalist id="lista-membros">
  <!-- As opções serão preenchidas dinamicamente com os nomes dos membros -->
      </datalist>
     
<!-- ===== SISTEMA DE AUTENTICAÇÃO SIMPLES ===== -->
<script>
    // ===== SISTEMA DE AUTENTICAÇÃO USANDO CSS EXISTENTE =====
    console.log('🎯 INICIANDO SISTEMA DE LOGIN...');

    // Configurações
    const LOGIN_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxn77v_c-kyOyC0OqcS0wM13jontZtDRrqygWGnkQ15d6ubumoBhvMpSXR5SMmtgNHv/exec';

    // Criar modal de login usando a estrutura existente
    function criarModalLogin() {
    console.log('🔧 Criando modal de login...');
    
    // REMOVER modal existente se houver
    const modalExistente = document.getElementById('modal-login');
    if (modalExistente) {
        modalExistente.remove();
    }
    
    const modalHTML = `
        <div id="modal-login" class="modal" style="display: flex; z-index: 99999; background: rgba(0,0,0,0.95);">
            <div class="modal-content" style="max-width: 450px; margin: 20px;">
                <div class="modal-header" style="text-align: center; border-bottom: none; padding: 30px 20px 0;">
                    <div style="font-size: 80px; color: var(--primary); margin-bottom: 15px;">🔒</div>
                    <h2 style="color: var(--primary); margin-bottom: 10px;">Acesso Restrito</h2>
                    <p style="color: var(--gray); margin: 0;">Departamento de Pessoal e Quadros - AGETRHA</p>
                </div>
                <div class="modal-body" style="padding: 20px 30px 30px;">
                    <div class="form-group">
                        <label for="login-password" style="font-weight: 600; margin-bottom: 8px;">Senha de Acesso:</label>
                        <input type="password" id="login-password" class="form-control" 
                               placeholder="Digite a senha" autocomplete="off"
                               style="padding: 12px 15px; font-size: 16px;">
                    </div>
                    
                    <div id="login-error" style="color: var(--danger); margin-top: 15px; display: none; 
                         background: rgba(220,53,69,0.1); padding: 10px; border-radius: 5px; text-align: center;">
                        <i class="fas fa-exclamation-triangle"></i> 
                        <span id="login-error-text">Senha incorreta!</span>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: none; padding: 0 30px 30px;">
                    <button class="btn btn-primary" id="btn-login" 
                            style="width: 100%; padding: 12px; font-size: 16px; font-weight: 600;">
                        <i class="fas fa-sign-in-alt"></i> Entrar no Sistema
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('afterbegin', modalHTML);
    console.log('✅ Modal de login criado com fundo bloqueador');
}

function forcarOcultacaoTotal() {
    console.log('🚨 FORÇANDO OCULTAÇÃO TOTAL...');
    
    // Ocultar TUDO exceto os modais de login/boas-vindas
    const todosElementos = document.querySelectorAll('body > *');
    todosElementos.forEach(elemento => {
        if (elemento.id !== 'modal-login' && elemento.id !== 'modal-welcome') {
            elemento.style.display = 'none';
            elemento.style.visibility = 'hidden';
        }
    });
    
    // Garantir que o body esteja limpo
    document.body.style.background = '#1a4e8e';
    document.body.style.overflow = 'hidden';
    
    console.log('✅ Ocultação total forçada');
}


        function ocultarAplicacao() {
    console.log('👻 Ocultando aplicação COMPLETAMENTE...');
    
    // Método 1: Ocultar todos os elementos visíveis da aplicação
    const todosElementos = document.body.children;
    for (let elemento of todosElementos) {
        if (elemento.id !== 'modal-login' && elemento.id !== 'modal-welcome') {
            elemento.style.display = 'none';
            elemento.style.visibility = 'hidden';
            elemento.style.opacity = '0';
        }
    }
    
    // Método 2: Estilos no body para garantir fundo limpo
    document.body.style.background = '#f5f7fa';
    document.body.style.overflow = 'hidden';
    document.body.style.margin = '0';
    document.body.style.padding = '0';
    document.body.style.height = '100vh';
    document.body.style.display = 'flex';
    document.body.style.justifyContent = 'center';
    document.body.style.alignItems = 'center';
    
    // Método 3: Remover qualquer conteúdo residual
    const elementosResiduais = document.querySelectorAll('body > *:not(#modal-login):not(#modal-welcome)');
    elementosResiduais.forEach(el => {
        el.style.display = 'none';
    });
    
    console.log('✅ Aplicação COMPLETAMENTE ocultada');
}

    function mostrarAplicacao() {
    console.log('👁️ Mostrando aplicação APÓS login...');
    
    // 1. Primeiro restaurar o body
    document.body.style.background = '';
    document.body.style.overflow = '';
    document.body.style.display = '';
    document.body.style.justifyContent = '';
    document.body.style.alignItems = '';
    document.body.style.height = '';
    document.body.style.margin = '';
    document.body.style.padding = '';
    
    // 2. Mostrar elementos principais um por um
    const elementosPrincipais = [
        '.sidebar',
        '.main-content'
    ];
    
    elementosPrincipais.forEach(seletor => {
        const elemento = document.querySelector(seletor);
        if (elemento) {
            elemento.style.display = '';
            elemento.style.visibility = 'visible';
            elemento.style.opacity = '1';
            elemento.style.position = '';
            elemento.style.left = '';
        }
    });
    
    // 3. Garantir que todo o conteúdo seja mostrado
    const todosElementos = document.body.children;
    for (let elemento of todosElementos) {
        if (elemento.id !== 'modal-login' && elemento.id !== 'modal-welcome') {
            elemento.style.display = '';
            elemento.style.visibility = 'visible';
            elemento.style.opacity = '1';
        }
    }
    
    console.log('✅ Aplicação RESTAURADA após login');
}

    // Esconder modal de login
    function esconderModalLogin() {
        const modal = document.getElementById('modal-login');
        if (modal) {
            modal.style.display = 'none';
        }
    }

    // Mostrar erro de login
    function mostrarErroLogin(mensagem) {
        const errorDiv = document.getElementById('login-error');
        const errorText = document.getElementById('login-error-text');
        
        if (errorDiv && errorText) {
            errorText.textContent = mensagem;
            errorDiv.style.display = 'block';
            
            // Efeito de shake usando CSS existente
            const modalContent = document.querySelector('#modal-login .modal-content');
            if (modalContent) {
                modalContent.style.animation = 'none';
                setTimeout(() => {
                    modalContent.style.animation = 'shake 0.5s';
                }, 10);
            }
        }
    }

    // Esconder erro de login
    function esconderErroLogin() {
        const errorDiv = document.getElementById('login-error');
        if (errorDiv) {
            errorDiv.style.display = 'none';
        }
    }

    // Validar senha no servidor
    async function validarSenha(senha) {
        try {
            console.log('🔐 Validando senha...');
            
            const formData = new FormData();
            formData.append('action', 'validateDashboardPassword');
            formData.append('password', senha);
            formData.append('department', 'DPQ');

            const response = await fetch(LOGIN_SCRIPT_URL, {
                method: 'POST',
                body: formData
            });

            const data = await response.json();
            return data;
            
        } catch (error) {
            console.error('❌ Erro na validação:', error);
            return { 
                valid: false, 
                message: 'Erro de conexão: ' + error.message 
            };
        }
    }

    // Processar tentativa de login
    async function processarLogin() {
        const passwordInput = document.getElementById('login-password');
        const loginButton = document.getElementById('btn-login');
        
        if (!passwordInput || !loginButton) {
            console.error('❌ Elementos do login não encontrados');
            return;
        }

        const senha = passwordInput.value.trim();
        
        if (!senha) {
            mostrarErroLogin('Por favor, digite a senha de acesso');
            return;
        }

        // Mostrar loading
        const originalText = loginButton.innerHTML;
        loginButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verificando...';
        loginButton.disabled = true;
        esconderErroLogin();

        try {
            const resultado = await validarSenha(senha);
            
            if (resultado.valid) {
                // Login bem-sucedido
                console.log('✅ Login bem-sucedido!');
                loginSucesso();
            } else {
                // Login falhou
                console.log('❌ Login falhou:', resultado.message);
                mostrarErroLogin(resultado.message || 'Senha incorreta!');
                passwordInput.value = '';
                passwordInput.focus();
            }
        } catch (error) {
            console.error('❌ Erro no login:', error);
            mostrarErroLogin('Erro de conexão. Tente novamente.');
        } finally {
            loginButton.innerHTML = originalText;
            loginButton.disabled = false;
        }
    }

    // Login bem-sucedido
function loginSucesso() {
    console.log('🚀 Login bem-sucedido, mostrando boas-vindas...');
    
    // Esconder modal de login
    esconderModalLogin();
    
    // Mostrar modal de boas-vindas
    mostrarModalBoasVindas();
    
    // Salvar estado de autenticação
    localStorage.setItem('dashboard-autenticado', 'true');
    localStorage.setItem('ultimo-login', Date.now().toString());
    
    console.log('✅ Modal de boas-vindas mostrado');
}

        // Inicializar aplicação
    function inicializarAplicacao() {
        console.log('🎯 Inicializando aplicação...');
        
        // Chamar funções de inicialização existentes, mas com cuidado
        if (typeof loadPresidentPhoto === 'function') {
            loadPresidentPhoto();
        }
        
        // ⚠️ IMPORTANTE: Não inicializar gráficos se já foram inicializados
        // Verificar se os gráficos já existem antes de inicializar
        const membersChart = document.getElementById('membersChart');
        const categoryChart = document.getElementById('categoryChart');
        
        if (membersChart && categoryChart) {
            // Verificar se os gráficos já foram inicializados
            if (typeof membersChart === 'undefined' || typeof categoryChart === 'undefined') {
                if (typeof inicializarGraficos === 'function') {
                    console.log('📊 Inicializando gráficos...');
                    inicializarGraficos();
                }
            } else {
                console.log('📊 Gráficos já inicializados, atualizando...');
                if (typeof atualizarGraficos === 'function') {
                    atualizarGraficos();
                }
            }
        }
        
        // Sincronizar dados (isso pode atualizar os gráficos)
        if (typeof sincronizarComSheets === 'function') {
            console.log('🔄 Sincronizando dados...');
            sincronizarComSheets();
        }
        
        // Navegar para a página inicial
        if (typeof alternarPagina === 'function') {
            console.log('🏠 Navegando para resumo...');
            alternarPagina('resumo');
        }
        
        console.log('✅ Aplicação inicializada');
    }


// Mostrar modal de boas-vindas
function mostrarModalBoasVindas() {
    const modal = document.getElementById('modal-welcome');
    if (modal) {
        modal.style.display = 'flex';
    }
}

// Esconder modal de boas-vindas
function esconderModalBoasVindas() {
    const modal = document.getElementById('modal-welcome');
    if (modal) {
        modal.style.display = 'none';
    }
}

// Processar continuação após boas-vindas
function processarContinuacao() {
    console.log('🎯 Continuando para o dashboard...');
    
    // Esconder modal de boas-vindas
    esconderModalBoasVindas();
    
    // Mostrar aplicação
    mostrarAplicacao();
    
    // Inicializar aplicação
    inicializarAplicacao();
    
    // Configurar logout automático
    configurarLogoutAutomatico();
}

    // Configurar logout automático
    function configurarLogoutAutomatico() {
        // Logout após 24 horas
        setTimeout(() => {
            localStorage.removeItem('dashboard-autenticado');
            localStorage.removeItem('ultimo-login');
            alert('Sessão expirada por segurança. Por favor, faça login novamente.');
            window.location.reload();
        }, 24 * 60 * 60 * 1000);
    }

    // Verificar autenticação existente
    function verificarAutenticacao() {
        console.log('🔍 Verificando autenticação...');
        
        const autenticado = localStorage.getItem('dashboard-autenticado');
        const ultimoLogin = localStorage.getItem('ultimo-login');
        
        console.log('📊 Status:', { autenticado, ultimoLogin });
        
        if (autenticado && ultimoLogin) {
            const tempoPassado = Date.now() - parseInt(ultimoLogin);
            const horasPassadas = tempoPassado / (1000 * 60 * 60);
            
            console.log(`⏰ Horas desde último login: ${horasPassadas.toFixed(2)}`);
            
            if (horasPassadas < 24) {
                // Ainda válido - mostrar aplicação
                console.log('✅ Sessão válida');
                mostrarAplicacao();
                inicializarAplicacao();
                return;
            } else {
                // Sessão expirada
                console.log('🔓 Sessão expirada');
                localStorage.removeItem('dashboard-autenticado');
                localStorage.removeItem('ultimo-login');
            }
        }
        
        // Não autenticado - mostrar login
        console.log('🔒 Não autenticado, mostrando login');
        ocultarAplicacao();
        mostrarModalLogin();
    }

    
    // Configurar event listeners
function configurarEventListeners() {
    console.log('🎮 Configurando event listeners...');
    
    const loginButton = document.getElementById('btn-login');
    const passwordInput = document.getElementById('login-password');
    
    if (loginButton) {
        loginButton.addEventListener('click', processarLogin);
        console.log('✅ Event listener do botão configurado');
    }
    
    if (passwordInput) {
        passwordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                processarLogin();
            }
        });
        console.log('✅ Event listener do input configurado');
    }
    
    // ===== NOVO: Event listener para o botão Continuar do modal de boas-vindas =====
    const btnContinuar = document.getElementById('btn-continuar-welcome');
    if (btnContinuar) {
        btnContinuar.addEventListener('click', processarContinuacao);
        console.log('✅ Event listener do botão Continuar configurado');
    }
}

    // Inicializar sistema
    function inicializarSistemaLogin() {
    console.log('🔐 INICIANDO SISTEMA DE LOGIN...');
    
    // Forçar ocultação ANTES de criar o modal
    forcarOcultacaoTotal();
    
    // Criar modal
    criarModalLogin();
    
    // Configurar event listeners
    configurarEventListeners();
    
    // Verificar autenticação
    verificarAutenticacao();
    
    console.log('✅ Sistema de login inicializado com ocultação total');
}


    // Iniciar quando o DOM estiver pronto
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', inicializarSistemaLogin);
    } else {
        inicializarSistemaLogin();
    }

    // Função de logout para debug
    window.logout = function() {
        console.log('🚪 Logout manual');
        localStorage.removeItem('dashboard-autenticado');
        localStorage.removeItem('ultimo-login');
        window.location.reload();
    };

    console.log('💡 Comando disponível: logout()');
</script>

<!-- Modal de Boas-vindas -->
<div id="modal-welcome" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 400px; text-align: center;">
        <div style="padding: 40px 20px;">
            <div style="font-size: 60px; color: #28a745; margin-bottom: 20px;">🎉</div>
            <h3 style="color: var(--primary); margin: 0 0 15px 0; font-weight: bold;">
                Seja bem-vindo(a)!
            </h3>
            <p style="color: var(--dark); margin: 0; font-size: 16px; line-height: 1.5;">
                Ao painel de gestão de membros!
            </p>
        </div>
        <div class="modal-footer" style="justify-content: center; border-top: none; padding-top: 0;">
            <button class="btn btn-primary" id="btn-continuar-welcome" style="min-width: 120px;">
                Continuar
            </button>
        </div>
    </div>
</div>

<!-- Modal de Boas-vindas -->
<div id="modal-welcome" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 400px; text-align: center;">
        <div style="padding: 40px 20px;">
            <div style="font-size: 60px; color: #28a745; margin-bottom: 20px;">🎉</div>
            <h3 style="color: var(--primary); margin: 0 0 15px 0; font-weight: bold;">
                Seja bem-vindo(a)!
            </h3>
            <p style="color: var(--dark); margin: 0; font-size: 16px; line-height: 1.5;">
                Ao painel de gestão de membros!
            </p>
        </div>
        <div class="modal-footer" style="justify-content: center; border-top: none; padding-top: 0;">
            <button class="btn btn-primary" id="btn-continuar-welcome" style="min-width: 120px;">
                Continuar
            </button>
        </div>
    </div>
</div>
</body>
</html>